I"´|<p><br /><br /></p>

<p><strong><em>í•´ë‹¹ ë‚´ìš©ì€ ì±… &lt;ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½ êµ¬ì¶•ì„ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤/ë„ì»¤&gt;ì— ë‚˜ì˜¤ëŠ” ë‚´ìš©ì´ë©° ì´ëŠ” ê°œì¸ì ìœ¼ë¡œ ê³µë¶€í•˜ê¸° ìœ„í•´ì„œ ê²Œì‹œí•˜ëŠ” ê¸€ì„ì„ ì•Œë¦½ë‹ˆë‹¤.</em></strong></p>

<p><br /><br />
<em><strong>ì»¤í”¼ ì¤‘ë…ìë˜ëŠ” ì¤‘â€¦</strong></em>
<br />
(Press the Button)</p>

<p><br /><br /></p>

<style>
.containercoffee {
  width: 300px;
  height: 280px;
  position: relative;
  top: calc(50% - 140px);
  left: calc(50% - 150px);
}
.coffee-header {
  width: 100%;
  height: 80px;
  position: absolute;
  top: 0;
  left: 0;
  background-color: #ddcfcc;
  border-radius: 10px;
}
.coffee-header__buttons {
  width: 25px;
  height: 25px;
  position: absolute;
  top: 25px;
  background-color: #282323;
  border-radius: 50%;
}
.coffee-header__buttons::after {
  content: "";
  width: 8px;
  height: 8px;
  position: absolute;
  bottom: -8px;
  left: calc(50% - 4px);
  background-color: #615e5e;
}
.coffee-header__button-one {
  left: 15px;
}
.coffee-header__button-two {
  left: 50px;
}
.coffee-header__display {
  width: 50px;
  height: 50px;
  position: absolute;
  top: calc(50% - 25px);
  left: calc(50% - 25px);
  border-radius: 50%;
  background-color: #9acfc5;
  border: 5px solid #43beae;
  box-sizing: border-box;
}
.coffee-header__details {
  width: 8px;
  height: 20px;
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #9b9091;
  box-shadow: -12px 0 0 #9b9091, -24px 0 0 #9b9091;
}
.coffee-medium {
  width: 90%;
  height: 160px;
  position: absolute;
  top: 80px;
  left: calc(50% - 45%);
  background-color: #bcb0af;
}
.coffee-medium:before {
  content: "";
  width: 90%;
  height: 100px;
  background-color: #776f6e;
  position: absolute;
  bottom: 0;
  left: calc(50% - 45%);
  border-radius: 20px 20px 0 0;
}
.coffe-medium__exit {
  width: 60px;
  height: 20px;
  position: absolute;
  top: 0;
  left: calc(50% - 30px);
  background-color: #231f20;
}
.coffe-medium__exit::before {
  content: "";
  width: 50px;
  height: 20px;
  border-radius: 0 0 50% 50%;
  position: absolute;
  bottom: -20px;
  left: calc(50% - 25px);
  background-color: #231f20;
}
.coffe-medium__exit::after {
  content: "";
  width: 10px;
  height: 10px;
  position: absolute;
  bottom: -30px;
  left: calc(50% - 5px);
  background-color: #231f20;
}
.coffee-medium__arm {
  width: 70px;
  height: 20px;
  position: absolute;
  top: 15px;
  right: 25px;
  background-color: #231f20;
}
.coffee-medium__arm::before {
  content: "";
  width: 15px;
  height: 5px;
  position: absolute;
  top: 7px;
  left: -15px;
  background-color: #9e9495;
}
.coffee-medium__cup {
  width: 80px;
  height: 47px;
  position: absolute;
  bottom: 0;
  left: calc(50% - 40px);
  background-color: #FFF;
  border-radius: 0 0 70px 70px / 0 0 110px 110px;
}
.coffee-medium__cup::after {
  content: "";
  width: 20px;
  height: 20px;
  position: absolute;
  top: 6px;
  right: -13px;
  border: 5px solid #FFF;
  border-radius: 50%;
}
@keyframes liquid {
  0% {
    height: 0px;  
    opacity: 1;
  }
  5% {
    height: 0px;  
    opacity: 1;
  }
  20% {
    height: 62px;  
    opacity: 1;
  }
  95% {
    height: 62px;
    opacity: 1;
  }
  100% {
    height: 62px;
    opacity: 0;
  }
}
.coffee-medium__liquid {
  width: 6px;
  height: 63px;
  opacity: 0;
  position: absolute;
  top: 50px;
  left: calc(50% - 3px);
  background-color: #74372b;
  animation: liquid 4s 4s linear infinite;
}
.coffee-medium__smoke {
  width: 8px;
  height: 20px;
  position: absolute;  
  border-radius: 5px;
  background-color: #b3aeae;
}
@keyframes smokeOne {
  0% {
    bottom: 20px;
    opacity: 0;
  }
  40% {
    bottom: 50px;
    opacity: .5;
  }
  80% {
    bottom: 80px;
    opacity: .3;
  }
  100% {
    bottom: 80px;
    opacity: 0;
  }
}
@keyframes smokeTwo {
  0% {
    bottom: 40px;
    opacity: 0;
  }
  40% {
    bottom: 70px;
    opacity: .5;
  }
  80% {
    bottom: 80px;
    opacity: .3;
  }
  100% {
    bottom: 80px;
    opacity: 0;
  }
}
.coffee-medium__smoke-one {
  opacity: 0;
  bottom: 50px;
  left: 102px;
  animation: smokeOne 3s 4s linear infinite;
}
.coffee-medium__smoke-two {
  opacity: 0;
  bottom: 70px;
  left: 118px;
  animation: smokeTwo 3s 5s linear infinite;
}
.coffee-medium__smoke-three {
  opacity: 0;
  bottom: 65px;
  right: 118px;
  animation: smokeTwo 3s 6s linear infinite;
}
.coffee-medium__smoke-for {
  opacity: 0;
  bottom: 50px;
  right: 102px;
  animation: smokeOne 3s 5s linear infinite;
}
.coffee-footer {
  width: 95%;
  height: 15px;
  position: absolute;
  bottom: 25px;
  left: calc(50% - 47.5%);
  background-color: #41bdad;
  border-radius: 10px;
}
.coffee-footer::after {
  content: "";
  width: 106%;
  height: 26px;
  position: absolute;
  bottom: -25px;
  left: -8px;
  background-color: #000;
}
</style>

<div class="containercoffee">
    <div class="coffee-header">
      <div class="coffee-header__buttons coffee-header__button-one"></div>
      <div class="coffee-header__buttons coffee-header__button-two"></div>
      <div class="coffee-header__display"></div>
      <div class="coffee-header__details"></div>
    </div>
    <div class="coffee-medium">
      <div class="coffe-medium__exit"></div>
      <div class="coffee-medium__arm"></div>
      <div class="coffee-medium__liquid"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-one"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-two"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-three"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-for"></div>
      <div class="coffee-medium__cup"></div>
    </div>
    <div class="coffee-footer"></div>
</div>

<p><br /><br /><br /><br /><br /><br /><br /><br /></p>

<h1 id="í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ-ëª¨ë‹ˆí„°ë§-ë°ì´í„°-ìˆ˜ì§‘ê³¼-í†µí•©í•˜ê¸°"><center>í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ ëª¨ë‹ˆí„°ë§ ë°ì´í„° ìˆ˜ì§‘ê³¼ í†µí•©í•˜ê¸°</center></h1>

<p><br /></p>

<p>í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ì  í‚¨ìŠ¤ì²˜ëŸ¼ í—¬ë¦„ìœ¼ë¡œ ì‰½ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤. ë‹¤ë§Œ ì  í‚¨ìŠ¤ ì„¤ì¹˜ ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ <span style="color:orange; font-weight:bold">NFS ë””ë ‰í„°ë¦¬(/nfs_shared/prometheus)</span>ë¥¼ ë§Œë“¤ê³ , ë§Œë“  NFS ë””ë ‰í„°ë¦¬ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ <span style="color:orange; font-weight:bold">PV</span>ì™€ <span style="color:orange; font-weight:bold">PVC</span>ë¡œ êµ¬ì„±í•´ì•¼ í•œë‹¤. ì ‘ê·¼ ID(ì‚¬ìš©ì ID, ê·¸ë£¹ ID)ëŠ” 1000ë²ˆìœ¼ë¡œ ì„¤ì •í•œë‹¤.</p>

<p><br /></p>

<link rel="stylesheet" href="https: //www.webnots.com/resources/font-awesome/css/font-awesome.min.css" />

<link rel="stylesheet" href="/assets/css/webnots.css" />

<div class="webnots-success webnots-notification-box">í”„ë¡œë©”í…Œìš°ìŠ¤ë¥¼ ì„¤ì¹˜í•˜ëŠ” ë° í•„ìš”í•œ ì‚¬ì „ ì¤€ë¹„ë¥¼ ìœ„í•´ MetalLBë¥¼ ì„¤ì¹˜í•˜ê³  í—¬ë¦„ìœ¼ë¡œ ë°°í¬ë¥¼ ê°„í¸í™” ì‹œì¼œì•¼ í•œë‹¤.</div>

<p><br /></p>

<p><span style="color: rgba(131, 24, 67);">MetalLB</span> ê´€ë ¨ ì‹¤ìŠµ ë‚´ìš©ì€ ì•„ë˜ ë§í¬ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><strong><a href="https://youngkyonyou.github.io/kubernetes/2021/08/01/Kubernetes-MetalLB-3.3.4.html">MetalLB</a></strong></p>

<p><br /></p>

<p>ì¼ë‹¨ ì±…ì˜ Chapter 5.2.2ë¥¼ í¼ì³ì„œ ì‚¬ì „ ì‘ì—…ì„ ì§„í–‰í•´ ë³¸ë‹¤.</p>

<p><br /></p>

<hr />

<p><span style="color:maroon; font-weight:bold; font-size:30px;">ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¡œ MetalLB í•œ ë²ˆì— ë§Œë“¤ê¸°</span></p>

<p><br /></p>

<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆëŠ” ì•¼ë¯ˆ íŒŒì¼ì— ì •ì˜ëœ ê°’ì„ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ìˆ˜ì • ì‚¬í•­ì„ ë°˜ì˜í•˜ë ¤ë©´ ì‚¬ìš©ìê°€ ì§ì ‘ ì•¼ë¯ˆ íŒŒì¼ì„ í¸ì§‘ê¸° í”„ë¡œê·¸ë¨ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•œë‹¤. ë§Œì•½ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ì•¼ë¯ˆ íŒŒì¼ì´ ë§¤ìš° ë§ê±°ë‚˜ í•˜ë‚˜ì˜ ì•¼ë¯ˆ íŒŒì¼ë¡œ í™˜ê²½ì´ ë‹¤ë¥¸ ì—¬ëŸ¬ ê°œì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬í•´ì•¼ í•´ì„œ <bold>LABEL</bold>ì´ë‚˜ <bold>NAME</bold> ê°™ì€ ì¼ë¶€ í•­ëª©ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤ë©´ ë§¤ë²ˆ ì¼ì¼ì´ ê³ ì¹˜ëŠ” ë° ë§ì€ ë…¸ë ¥ì´ ë“ ë‹¤. ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆëŠ” ì´ë¥¼ ìœ„í•´ kustomize ëª…ë ¹ì„ ì œê³µí•œë‹¤. kustomize ëª…ë ¹ê³¼ creat ì˜µì…˜ìœ¼ë¡œ kustomization.yamlì´ë¼ëŠ” ê¸°ë³¸ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê³  ì´ íŒŒì¼ì— ë³€ê²½í•´ì•¼ í•˜ëŠ” ê°’ë“¤ì„ ì ìš©í•œë‹¤. ê·¸ë¦¬ê³  build ì˜µì…˜ìœ¼ë¡œ ë³€ê²½í•  ë‚´ìš©ì´ ì ìš©ëœ ìµœì¢… ì•¼ë¯ˆ íŒŒì¼ì„ ì €ì¥í•˜ê±°ë‚˜ ë³€ê²½ëœ ë‚´ìš©ì´ ë°”ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì§€ì •í•œë‹¤. </div>

<p><br /></p>

<p>ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ëª…ë ¹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <strong>~/_Book_k8sInfra.ch5/5.2.2/kustomize-install.sh</strong>ë¥¼ ì‹¤í–‰í•´ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ì••ì¶• íŒŒì¼ì„ ë‚´ë ¤ë°›ëŠ”ë‹¤.</p>

<p><br /></p>

<p><strong>kustomize-install.sh</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
curl <span class="nt">-L</span> <span class="se">\</span>
https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2Fv3.6.1/kustomize_v3.6.1_linux_amd64.tar.gz <span class="nt">-o</span> /tmp/kustomize.tar.gz
<span class="nb">tar</span> <span class="nt">-xzf</span> /tmp/kustomize.tar.gz <span class="nt">-C</span>  /usr/local/bin
<span class="nb">echo</span> <span class="s2">"kustomize install successfully"</span>

</code></pre></div></div>

<p><br /></p>

<p>í•œ ì¤„ í•œ ì¤„ ì˜ë¯¸ë¥¼ ì•Œì•„ ë³´ì.</p>

<p><br /></p>

<p><strong>kustomize-install.sh</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>
<span class="c">#curlì€ ì‚¬ìš©ì ìƒí˜¸ ì‘ìš© ì—†ì´ ì‘ë™í•˜ë„ë¡ ì„¤ê³„ëœ ì„œë²„ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•œ ëª…ë ¹ì¤„ ìœ í‹¸ë¦¬í‹°ì´ë‹¤.</span>
<span class="c">#curlì„ ì‚¬ìš©í•˜ë©´ HTTP, HTTPS, SCP, SFTP ë° FTP ë“± ì§€ì›ë˜ëŠ” í”„ë¡œí† ì½œ ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê±°ë‚˜ ì—…ë¡œë“œí•  ìˆ˜ ìˆë‹¤.</span>
<span class="c">#curlì˜ -L ì˜µì…˜ì€ ì„œë²„ì—ì„œ HTTP 301ì´ë‚˜ HTTP 302 ì‘ë‹µì´ ì™”ì„ ê²½ìš° redirection URLë¡œ ë”°ë¼ê°„ë‹¤ëŠ” ê²ƒì´ë‹¤.</span>
<span class="c">#301ì€ 301, Permanently Moved</span>
<span class="c">#Permanentlyë¼ëŠ” ëœ»ì´ ì˜êµ¬íˆ, ì˜êµ¬ì ì¸ ì´ë¼ëŠ” ëœ»ì´ë¯€ë¡œ, ì˜êµ¬ì ìœ¼ë¡œ ì´ë™í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì´ë™ í˜ì´ì§€ë¡œ ì´ë™ë˜ì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.</span>
<span class="c">#302, Temporarily Moved</span>
<span class="c">#Temporarilyë¼ëŠ” ëœ»ì´ ì„ì‹œì , ì„ì‹œì ì¸ ì´ë¼ëŠ” ëœ»ì´ë¯€ë¡œ, ì„ì‹œì ìœ¼ë¡œ ì´ë™í–ˆë‹¤ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ìš”ì²­ëœ ë¦¬ì†ŒìŠ¤ê°€ ì„ì‹œì ìœ¼ë¡œ ì´ë™ í˜ì´ì§€ë¡œ ì´ë™ë˜ì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.</span>
<span class="c"># '\' í‘œì‹œëŠ” ì¤„ë°”ê¿ˆí•˜ëŠ” ê²ƒì´ë‹¤.</span>
curl <span class="nt">-L</span> <span class="se">\</span>

<span class="c">#-o ì˜µì…˜ì€ í•´ë‹¹ ë§í¬ì—ì„œ ë‹¤ìš´ë¡œë“œ ë°›ì€ ê²°ê³¼ë¥¼ ì§€ì •í•œ /tmp ì•„ë˜ kustomize.tar.gzë¼ëŠ” ì´ë¦„ì˜ íŒŒì¼ë¡œ ì €ì¥í•œë‹¤.</span>
<span class="c">#ìœˆë„ìš°ì—ì„œ ê¸°ë³¸ì ì´ê³  ë§ì´ ì‚¬ìš©í•˜ëŠ” ì••ì¶• í˜•ì‹ì´ zipì´ë¼ë©´</span>
<span class="c">#ë¦¬ëˆ…ìŠ¤ì—ì„œëŠ” tar.gzë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤. ë¦¬ëˆ…ìŠ¤ì—ì„œ tar.gzëŠ” ë³„ë„ì˜</span>
<span class="c">#ì„¤ì¹˜ ì—†ì´ ê¸°ë³¸ì ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ì••ì¶• í˜•ì‹ì´ë‹¤.</span>
https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize%2Fv3.6.1/kustomize_v3.6.1_linux_amd64.tar.gz <span class="nt">-o</span> /tmp/kustomize.tar.gz

<span class="c">#tar -xzfëŠ” ì••ì¶•ì„ í•´ì œí•˜ëŠ” ëª…ë ¹ì´ë‹¤.</span>
<span class="c">#tar ì˜µì…˜ -x: ë¬¶ìŒì„ í•´ì œ</span>
<span class="c">#-z: gunzipì„ ì‚¬ìš©</span>
<span class="c">#-f: íŒŒì¼ ì´ë¦„ì„ ì§€ì •</span>
<span class="c">#ì¦‰ /tmp ì•„ë˜ kustomize.tar.gz íŒŒì¼ì˜ ì••ì¶•ì„ í•´ì œí•œë‹¤.</span>
<span class="c">#-C ì˜µì…˜ì€ ì••ì¶•ì„ í•´ì œí•œ ë‹¤ìŒì— /usr/local/bin ë””ë ‰í„°ë¦¬ì— ë„£ìœ¼ë¼ëŠ” ê²ƒì´ë‹¤.</span>
<span class="c">#ì´ë¥¼ í†µí•´ ë°°ì‹œ ì‰˜ì—ì„œ ë°”ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤.</span>
<span class="nb">tar</span> <span class="nt">-xzf</span> /tmp/kustomize.tar.gz <span class="nt">-C</span>  /usr/local/bin
<span class="nb">echo</span> <span class="s2">"kustomize install successfully"</span>

</code></pre></div></div>

<p><br /></p>

<p>ìœ„ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•œë‹¤. ê·¸ ë‹¤ìŒ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆì—ì„œ ë¦¬ì†ŒìŠ¤ ë° ì£¼ì†Œ í• ë‹¹ ì˜ì—­(Pool)ì„ êµ¬ì„±í•  ë•Œ ì‚¬ìš©í•  íŒŒì¼ë“¤ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ <strong>~/_Book_k8sInfra/ch5/5.2.2</strong> ë””ë ‰í„°ë¦¬ë¡œ ì´ë™í•˜ê³  <strong>metallb-l2config.yaml, metallb.yaml, namespace.yaml</strong>ì´ ìˆëŠ” ê²ƒì„ í™•ì¸í•˜ê³  ê°ê°ì„ ì‚´í´ë³´ì.</p>

<p><br /></p>

<p><strong>metallb-l2config.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="s">address-pools:</span>
    <span class="s">- name: nginx-ip-range</span>
      <span class="s">protocol: layer2</span>
      <span class="s">addresses:</span>
      <span class="s">- 192.168.1.11-192.168.1.13</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>metallb-l2config.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#apiVersion: API ë²„ì „ì„ ëª…ì‹œí•œë‹¤</span>
<span class="c1">#ì´ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ API ë²„ì „ì´ ì–´ë–¤ ê²ƒì¸ì§€</span>
<span class="c1">#ëª…ì‹œí•œë‹¤.</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>

<span class="c1">#ì–´ë–¤ ì¢…ë¥˜ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ ì í•˜ëŠ”ì§€ ëª…ì‹œí•œë‹¤.</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>

<span class="c1">#ì´ë¦„ ë¬¸ìì—´, UID, ê·¸ë¦¬ê³  ì„ íƒì ì¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ í¬í•¨í•˜ì—¬</span>
<span class="c1">#ì˜¤ë¸Œì íŠ¸ë¥¼ ìœ ì¼í•˜ê²Œ êµ¬ë¶„ì§€ì–´ ì¤„ ë°ì´í„°ì´ë‹¤.</span>
<span class="c1">#ì„œë¹„ìŠ¤ ì´ë¦„(name)ì€ configì´ë‹¤.</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="c1">#ConfigMapì´ ìœ„ì¹˜í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼</span>
  <span class="c1">#metallb-systemë¡œ í•œë‹¤.</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>

<span class="na">data</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span> <span class="pi">|</span>

    <span class="s">#metallbì˜ ì„¸ë¶€ ì„¤ì •</span>
    <span class="s">#address-poolsì˜ ì´ë¦„ì„ nginx-ip-rangeë¡œ ì„¤ì •í•œë‹¤. </span>
     <span class="s">address-pools:</span>
     <span class="s">- name: nginx-ip-range</span>

       <span class="s">#metallbì—ì„œ ì œê³µí•˜ëŠ” ë¡œë“œë°¸ëŸ°ì„œì˜ ë™ì‘ ë°©ì‹ì´ë‹¤. ì¦‰ L2 ë°©ì‹ì´ë‹¤.</span>
       <span class="s">protocol: layer2</span>

       <span class="s">#metallbì—ì„œ ì œê³µí•˜ëŠ” ë¡œë“œë°¸ëŸ¬ì„œì˜ External ì£¼ì†Œì´ë‹¤.</span>
       <span class="s">#ì´ ë²”ìœ„ ì•ˆì—ì„œ External ì£¼ì†Œë¥¼ ë¶€ì—¬í•œë‹¤.</span>
       <span class="s">addresses:</span>
       <span class="s">- 192.168.1.11-192.168.1.13</span>
</code></pre></div></div>

<p><br /></p>

<p>metallb.yaml ì„¤ëª…ì€ ìƒëµí•œë‹¤.</p>

<p><br /></p>

<p><strong>metallb.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">policy/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PodSecurityPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
  <span class="na">allowedCapabilities</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">NET_ADMIN</span>
    <span class="pi">-</span> <span class="s">NET_RAW</span>
    <span class="pi">-</span> <span class="s">SYS_ADMIN</span>
  <span class="na">fsGroup</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">hostPorts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">max</span><span class="pi">:</span> <span class="m">7472</span>
      <span class="na">min</span><span class="pi">:</span> <span class="m">7472</span>
  <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">runAsUser</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">seLinux</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">supplementalGroups</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:controller</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">services</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
      <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">services/status</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">update</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">events</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">create</span>
      <span class="pi">-</span> <span class="s">patch</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:speaker</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">services</span>
      <span class="pi">-</span> <span class="s">endpoints</span>
      <span class="pi">-</span> <span class="s">nodes</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">events</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">create</span>
      <span class="pi">-</span> <span class="s">patch</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">extensions</span>
    <span class="na">resourceNames</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">speaker</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">podsecuritypolicies</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">use</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config-watcher</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">configmaps</span>
    <span class="na">verbs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">get</span>
      <span class="pi">-</span> <span class="s">list</span>
      <span class="pi">-</span> <span class="s">watch</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:controller</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:controller</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:speaker</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system:speaker</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">RoleBinding</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config-watcher</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Role</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">config-watcher</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">DaemonSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">speaker</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">speaker</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">prometheus.io/port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">7472"</span>
        <span class="s">prometheus.io/scrape</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">speaker</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">--port=7472</span>
            <span class="pi">-</span> <span class="s">--config=config</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">METALLB_NODE_NAME</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">METALLB_HOST</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.hostIP</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">metallb/speaker:v0.8.2</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">speaker</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7472</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">monitoring</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">100Mi</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
            <span class="na">capabilities</span><span class="pi">:</span>
              <span class="na">add</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">NET_ADMIN</span>
                <span class="pi">-</span> <span class="s">NET_RAW</span>
                <span class="pi">-</span> <span class="s">SYS_ADMIN</span>
              <span class="na">drop</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">ALL</span>
            <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">hostNetwork</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="s">beta.kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">speaker</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">0</span>
      <span class="na">tolerations</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">effect</span><span class="pi">:</span> <span class="s">NoSchedule</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">node-role.kubernetes.io/master</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
    <span class="na">component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">metallb-system</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">revisionHistoryLimit</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
      <span class="na">component</span><span class="pi">:</span> <span class="s">controller</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">annotations</span><span class="pi">:</span>
        <span class="s">prometheus.io/port</span><span class="pi">:</span> <span class="s2">"</span><span class="s">7472"</span>
        <span class="s">prometheus.io/scrape</span><span class="pi">:</span> <span class="s2">"</span><span class="s">true"</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
        <span class="na">component</span><span class="pi">:</span> <span class="s">controller</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">args</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">--port=7472</span>
            <span class="pi">-</span> <span class="s">--config=config</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">metallb/controller:v0.8.2</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">controller</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">7472</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">monitoring</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">100Mi</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="no">false</span>
            <span class="na">capabilities</span><span class="pi">:</span>
              <span class="na">drop</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">all</span>
            <span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">nodeSelector</span><span class="pi">:</span>
        <span class="s">beta.kubernetes.io/os</span><span class="pi">:</span> <span class="s">linux</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="na">runAsNonRoot</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">runAsUser</span><span class="pi">:</span> <span class="m">65534</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">controller</span>
      <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">0</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>namespace.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>namespace.yaml</strong></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#ë²„ì ¼ ëª…ì‹œ</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>

<span class="c1">#ì˜¤ë¸Œì íŠ¸ ì¢…ë¥˜ ëª…ì‹œ</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>

<span class="c1">#ì˜¤ë¸Œì íŠ¸ ì´ë¦„ metallb-systemìœ¼ë¡œ ì§€ì •</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">metallb-system</span>

  <span class="c1">#ë ˆì´ë¸” ì§€ì •</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">metallb</span>
</code></pre></div></div>

<p><br /></p>

<p>ì´ì œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¡œ ë³€ê²½ë  ì‘ì—…ì„ ì •ì˜í•˜ê¸° ìœ„í•´ì„œ <strong>kustomize create â€“namespace=metallb-system â€“resources namespace.yaml, metallb.yaml, metallb-l2config.yaml</strong> ëª…ë ¹ìœ¼ë¡œ <span style="color:orange; font-weight:bold">kustomization.yaml</span>ì„ ìƒì„±í•œë‹¤. ì´ë•Œ â€“namespaceëŠ” ì‘ì—…ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ë©°, â€“resources ëª…ë ¹ì€ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ëª…ë ¹ì„ ì´ìš©í•´ì„œ <strong>kustomization.yaml</strong>ë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ì†ŒìŠ¤ íŒŒì¼ì„ ì •ì˜í•œë‹¤.</p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kustomize create <span class="nt">--namespace</span><span class="o">=</span>metallb-system <span class="nt">--resources</span> namespace.yaml, metallb.yaml, metallb-l2config.yaml
</code></pre></div></div>

<p><br /></p>

<p>ìƒì„±í•œ kustomization.yaml íŒŒì¼ì„ ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-20-52.png" alt="" /></p>

<p><br /></p>

<p>ë¦¬ì†ŒìŠ¤ë¡œ <strong>namespace.yaml, metallb.yaml ê·¸ë¦¬ê³  metallb-l2config.yaml</strong>ì´ ì„¤ì •ëê³ , ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” <strong>metallb-system</strong>ìœ¼ë¡œ ì„¤ì •ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p>ì„¤ì¹˜ëœ ì´ë¯¸ì§€ë¥¼ ì•ˆì •ì ì¸ ë²„ì „ìœ¼ë¡œ ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ <strong>kustomize edit set image</strong> ì˜µì…˜ì„ ì´ìš©í•´ MetalLB controllerì™€ speakerì˜ ì´ë¯¸ì§€ íƒœê·¸ë¥¼ <strong>v0.8.2</strong>ë¡œ ì§€ì •í•œë‹¤.</p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kustomize edit <span class="nb">set </span>image metallb/controller:v0.8.2
kustomize edit <span class="nb">set </span>image metallb/speaker:v0.8.2
</code></pre></div></div>

<p><br /></p>

<p>ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¡œ ìƒì„±ëœ kustomization.yamlì— ì´ë¯¸ì§€ íƒœê·¸ ì •ë³´(v0.8.2)ê°€ ì„¤ì •ëëŠ”ì§€ í™•ì¸í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-20-26.png" alt="" /></p>

<p><br /></p>

<p>ì´ì œ kustomizae build ëª…ë ¹ìœ¼ë¡œ MetalLB ì„¤ì¹˜ë¥¼ ìœ„í•œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ìƒì„±í•´ ë³´ë©´, ë‹¤ìŒê³¼ ê°™ì´ metallb-l2config.yamlì„ í†µí•´ì„œ ì»¨í”¼ê·¸ë§µì´ ë§Œë“¤ì–´ì¡Œìœ¼ë©°, ì´ë¯¸ì§€ íƒœê·¸ì¸ v0.8.2ê°€ ì ìš©ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-22-38.png" alt="" /></p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-23-27.png" alt="" /></p>

<p><br /></p>

<table>
  <tbody>
    <tr>
      <td>ì´ë¥¼ íŒŒì¼ë¡œ ì €ì¥í•´ MetalLBë¥¼ ë°°í¬í•  ìˆ˜ë„ ìˆì§€ë§Œ í¸ì˜ë¥¼ ìœ„í•´ì„œ **kustomize build</td>
      <td>kubectl apply -f -** ëª…ë ¹ìœ¼ë¡œ ë¹Œë“œí•œ ê²°ê³¼í•œ ë°”ë¡œ kubectl applyì— ì¸ìë¡œ ì „ë‹¬ë¼ ë°°í¬ë˜ë„ë¡ í•œë‹¤.</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kustomize build | kubectl apply <span class="nt">-f</span> -
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-26-09.png" alt="" /></p>

<p><br /></p>

<p>MetalLBê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ëëŠ”ì§€ <strong>kubectl get pods -n metallb-system</strong> ëª…ë ¹ê³¼ <strong>kubectl get configmap -n metallb-system</strong> ëª…ë ¹ìœ¼ë¡œ í™•ì¸í•œë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get pods <span class="nt">-n</span> metallb-system
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-28-10.png" alt="" /></p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl get configmap <span class="nt">-n</span> metallb-system
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-29-32.png" alt="" /></p>

<p><br /></p>

<table>
  <tbody>
    <tr>
      <td>**kubectl describe pods -n metallbe-system</td>
      <td>grep Image:** ëª…ë ¹ìœ¼ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¥¼ í†µí•´ì„œ ê³ ì •í•œ MetalLBì˜ íƒœê·¸ê°€ v0.8.2ì¸ì§€ í™•ì¸í•œë‹¤.</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl describe pods <span class="nt">-n</span> metallb-system | <span class="nb">grep </span>Image:
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-11-31-24.png" alt="" /></p>

<p><br /></p>

<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

ë‚˜ì¤‘ì— ìš°ë¦¬ê°€ ìƒì„±í•œ MetalLBë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°<br />

kustomize build | kubectl delete -f - </div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-00-04.png" alt="" /></p>

<p><br /></p>

<p>ìš°ë¦¬ëŠ” ì•„ë˜ì—ì„œ í—¬ë¦„ìœ¼ë¡œ MetalLBë¥¼ êµ¬ì„±í•  ê²ƒì´ê¸° ë•Œë¬¸ì— ì‚­ì œë¥¼ í•œë‹¤.</p>

<p><br /></p>

<p><span style="color:#85144b; font-weight:bold; font-size:30px;">í—¬ë¦„ìœ¼ë¡œ ë°°í¬ ê°„í¸í™”í•˜ê¸°</span></p>

<p><br /></p>

<p>í—¬ë¦„ì„ í†µí•œ ë°°í¬ëŠ” ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆì—ì„œ ì œí•œì ì´ì—ˆë˜ ì£¼ì†Œ í• ë‹¹ ì˜ì—­ê³¼ ê°™ì€ ê°’ì„ ëŒ€ì²´í•˜ë©´ì„œ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë¼ ìˆë‹¤. í—¬ë¦„ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ì— íŒ¨í‚¤ì§€ë¥¼ ì†ì‰½ê²Œ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ íŒ¨í‚¤ì§€ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ ì „ìš© íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ íŒ¨í‚¤ì§€ëŠ” ì‹¤í–‰ íŒŒì¼ë¿ë§Œ ì•„ë‹ˆë¼ ì‹¤í–‰ í™˜ê²½ì— í•„ìš”í•œ ì˜ì¡´ì„± íŒŒì¼ê³¼ í™˜ê²½ ì •ë³´ë“¤ì˜ ë¬¶ìŒì´ë‹¤.</p>

<p><br /></p>

<p>ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¥¼ ì‚¬ìš©í•˜ë©´ ë§ì€ ë¶€ë¶„ì„ í™˜ê²½ì— ë§ì¶° ë³€ê²½í•  ìˆ˜ ìˆì§€ë§Œ ì£¼ì†Œ í• ë‹¹ ì˜ì—­ê³¼ ê°™ì€ ì •ë³´ëŠ” ê°’ì˜ í˜•íƒœê°€ ì•„ë‹ˆë¼ì„œ ë³€ê²½í•  ìˆ˜ê°€ ì—†ë‹¤. ì´ëŸ° ê²½ìš°ì— í—¬ë¦„ì„ ì‚¬ìš©í•˜ë©´ ì£¼ì†Œ í• ë‹¹ ì˜ì—­ë„ ë³€ê²½ì´ ê°€ëŠ¥í•˜ë‹¤. ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆì—ì„œ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ê°’ì„ í™˜ê²½ì— ë§ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ëŠ” ì  ì™¸ì—ë„ í—¬ë¦„ì€ ì—¬ëŸ¬ ì¥ì ì´ ìˆë‹¤.</p>

<p><br /></p>

<p>ì´ì œ í—¬ë¦„ìœ¼ë¡œ MetalLBë¥¼ í•œ ë²ˆì— ë§Œë“¤ì–´ë³´ì.</p>

<p>ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆë¥¼ í†µí•´ì„œë„ ë³€ë™ì´ ìˆëŠ” ê°’ê³¼ ì»¨í”¼ê·¸ë§µ íŒŒì¼ì„ ì‰½ê²Œ ì„¤ì¹˜í–ˆì—ˆë‹¤. í—¬ë¦„ì„ ì‚¬ìš©í•˜ë©´ ì–¼ë§ˆë‚˜ ë” í¸í•´ì§ˆê¹Œ? ì´ì œë¶€í„° í™•ì¸í•´ ë³´ì.</p>

<p>í—¬ë¦„ ëª…ë ¹ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <strong>~/_Book_k8sInfra/ch5/5.2.3/helm-install.sh</strong>ë¥¼ ì‹¤í–‰í•´ í—¬ë¦„ì„ ì„¤ì¹˜í•œë‹¤. helm-install.shë¥¼ ì‹¤í–‰í•˜ë©´ í•­ìƒ ìµœì‹  ë²„ì „ì˜ í—¬ë¦„ì„ ë‚´ë ¤ë°›ê¸° ë•Œë¬¸ì— í˜¸í™˜ì„± ì´ìŠˆë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ <strong>DESIRED_VERSION</strong> í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ í—¬ë¦„ ë²„ì „ì„ v3.2.1ë¡œ ê³ ì •í•´ ì„¤ì¹˜í•œë‹¤. í—¬ë¦„ ì‹¤í–‰ íŒŒì¼ë„ /usr/local/binì— ìœ„ì¹˜ì‹œí‚¨ë‹¤.</p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">DESIRED_VERSION</span><span class="o">=</span>v3.2.1<span class="p">;</span> ~/Book_k8sInfra/ch5/5.2.3/helm-install.sh
</code></pre></div></div>

<p><br /></p>

<p><strong>helm-install.sh</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/env bash</span>

<span class="c"># Copyright The Helm Authors.</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at</span>
<span class="c">#</span>
<span class="c">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>

<span class="c"># The install script is based off of the MIT-licensed script from glide,</span>
<span class="c"># the package manager for Go: https://github.com/Masterminds/glide.sh/blob/master/get</span>

: <span class="k">${</span><span class="nv">BINARY_NAME</span>:<span class="p">=</span><span class="s2">"helm"</span><span class="k">}</span>
: <span class="k">${</span><span class="nv">USE_SUDO</span>:<span class="p">=</span><span class="s2">"true"</span><span class="k">}</span>
: <span class="k">${</span><span class="nv">DEBUG</span>:<span class="p">=</span><span class="s2">"false"</span><span class="k">}</span>
: <span class="k">${</span><span class="nv">VERIFY_CHECKSUM</span>:<span class="p">=</span><span class="s2">"true"</span><span class="k">}</span>
: <span class="k">${</span><span class="nv">VERIFY_SIGNATURES</span>:<span class="p">=</span><span class="s2">"false"</span><span class="k">}</span>
: <span class="k">${</span><span class="nv">HELM_INSTALL_DIR</span>:<span class="p">=</span><span class="s2">"/usr/local/bin"</span><span class="k">}</span>

<span class="nv">HAS_CURL</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">type</span> <span class="s2">"curl"</span> &amp;&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo true</span> <span class="o">||</span> <span class="nb">echo false</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">HAS_WGET</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">type</span> <span class="s2">"wget"</span> &amp;&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo true</span> <span class="o">||</span> <span class="nb">echo false</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">HAS_OPENSSL</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">type</span> <span class="s2">"openssl"</span> &amp;&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo true</span> <span class="o">||</span> <span class="nb">echo false</span><span class="si">)</span><span class="s2">"</span>
<span class="nv">HAS_GPG</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">type</span> <span class="s2">"gpg"</span> &amp;&gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo true</span> <span class="o">||</span> <span class="nb">echo false</span><span class="si">)</span><span class="s2">"</span>

<span class="c"># initArch discovers the architecture for this system.</span>
initArch<span class="o">()</span> <span class="o">{</span>
  <span class="nv">ARCH</span><span class="o">=</span><span class="si">$(</span><span class="nb">uname</span> <span class="nt">-m</span><span class="si">)</span>
  <span class="k">case</span> <span class="nv">$ARCH</span> <span class="k">in
    </span>armv5<span class="k">*</span><span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"armv5"</span><span class="p">;;</span>
    armv6<span class="k">*</span><span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"armv6"</span><span class="p">;;</span>
    armv7<span class="k">*</span><span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"arm"</span><span class="p">;;</span>
    aarch64<span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"arm64"</span><span class="p">;;</span>
    x86<span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"386"</span><span class="p">;;</span>
    x86_64<span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"amd64"</span><span class="p">;;</span>
    i686<span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"386"</span><span class="p">;;</span>
    i386<span class="p">)</span> <span class="nv">ARCH</span><span class="o">=</span><span class="s2">"386"</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="o">}</span>

<span class="c"># initOS discovers the operating system for this system.</span>
initOS<span class="o">()</span> <span class="o">{</span>
  <span class="nv">OS</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="sb">`</span><span class="nb">uname</span><span class="sb">`</span>|tr <span class="s1">'[:upper:]'</span> <span class="s1">'[:lower:]'</span><span class="si">)</span>

  <span class="k">case</span> <span class="s2">"</span><span class="nv">$OS</span><span class="s2">"</span> <span class="k">in</span>
    <span class="c"># Minimalist GNU for Windows</span>
    mingw<span class="k">*</span><span class="p">)</span> <span class="nv">OS</span><span class="o">=</span><span class="s1">'windows'</span><span class="p">;;</span>
  <span class="k">esac</span>
<span class="o">}</span>

<span class="c"># runs the given command as root (detects if we are root already)</span>
runAsRoot<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">CMD</span><span class="o">=</span><span class="s2">"</span><span class="nv">$*</span><span class="s2">"</span>

  <span class="k">if</span> <span class="o">[</span> <span class="nv">$EUID</span> <span class="nt">-ne</span> 0 <span class="nt">-a</span> <span class="nv">$USE_SUDO</span> <span class="o">=</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">CMD</span><span class="o">=</span><span class="s2">"sudo </span><span class="nv">$CMD</span><span class="s2">"</span>
  <span class="k">fi</span>

  <span class="nv">$CMD</span>
<span class="o">}</span>

<span class="c"># verifySupported checks that the os/arch combination is supported for</span>
<span class="c"># binary builds, as well whether or not necessary tools are present.</span>
verifySupported<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">supported</span><span class="o">=</span><span class="s2">"darwin-amd64</span><span class="se">\n</span><span class="s2">linux-386</span><span class="se">\n</span><span class="s2">linux-amd64</span><span class="se">\n</span><span class="s2">linux-arm</span><span class="se">\n</span><span class="s2">linux-arm64</span><span class="se">\n</span><span class="s2">linux-ppc64le</span><span class="se">\n</span><span class="s2">linux-s390x</span><span class="se">\n</span><span class="s2">windows-amd64"</span>
  <span class="k">if</span> <span class="o">!</span> <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">supported</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"No prebuilt binary for </span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">."</span>
    <span class="nb">echo</span> <span class="s2">"To build from source, go to https://github.com/helm/helm"</span>
    <span class="nb">exit </span>1
  <span class="k">fi

  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_CURL</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"true"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_WGET</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Either curl or wget is required"</span>
    <span class="nb">exit </span>1
  <span class="k">fi

  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VERIFY_CHECKSUM</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_OPENSSL</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"In order to verify checksum, openssl must first be installed."</span>
    <span class="nb">echo</span> <span class="s2">"Please install openssl or set VERIFY_CHECKSUM=false in your environment."</span>
    <span class="nb">exit </span>1
  <span class="k">fi

  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VERIFY_SIGNATURES</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_GPG</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"In order to verify signatures, gpg must first be installed."</span>
      <span class="nb">echo</span> <span class="s2">"Please install gpg or set VERIFY_SIGNATURES=false in your environment."</span>
      <span class="nb">exit </span>1
    <span class="k">fi
    if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"linux"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"Signature verification is currently only supported on Linux."</span>
      <span class="nb">echo</span> <span class="s2">"Please set VERIFY_SIGNATURES=false or verify the signatures manually."</span>
      <span class="nb">exit </span>1
    <span class="k">fi
  fi</span>
<span class="o">}</span>

<span class="c"># checkDesiredVersion checks if the desired version is available.</span>
checkDesiredVersion<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"x</span><span class="nv">$DESIRED_VERSION</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"x"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c"># Get tag from release URL</span>
    <span class="nb">local </span><span class="nv">latest_release_url</span><span class="o">=</span><span class="s2">"https://github.com/helm/helm/releases"</span>
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_CURL</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nv">TAG</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-Ls</span> <span class="nv">$latest_release_url</span> | <span class="nb">grep</span> <span class="s1">'href="/helm/helm/releases/tag/v3.[0-9]*.[0-9]*\"'</span> | <span class="nb">grep</span> <span class="nt">-v</span> no-underline | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'"'</span> <span class="nt">-f</span> 2 | <span class="nb">awk</span> <span class="s1">'{n=split($NF,a,"/");print a[n]}'</span> | <span class="nb">awk</span> <span class="s1">'a !~ $0{print}; {a=$0}'</span><span class="si">)</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_WGET</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
      </span><span class="nv">TAG</span><span class="o">=</span><span class="si">$(</span>wget <span class="nv">$latest_release_url</span> <span class="nt">-O</span> - 2&gt;&amp;1 | <span class="nb">grep</span> <span class="s1">'href="/helm/helm/releases/tag/v3.[0-9]*.[0-9]*\"'</span> | <span class="nb">grep</span> <span class="nt">-v</span> no-underline | <span class="nb">head</span> <span class="nt">-n</span> 1 | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">'"'</span> <span class="nt">-f</span> 2 | <span class="nb">awk</span> <span class="s1">'{n=split($NF,a,"/");print a[n]}'</span> | <span class="nb">awk</span> <span class="s1">'a !~ $0{print}; {a=$0}'</span><span class="si">)</span>
    <span class="k">fi
  else
    </span><span class="nv">TAG</span><span class="o">=</span><span class="nv">$DESIRED_VERSION</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># checkHelmInstalledVersion checks which version of helm is installed and</span>
<span class="c"># if it needs to be changed.</span>
checkHelmInstalledVersion<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_INSTALL_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">BINARY_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">local </span><span class="nv">version</span><span class="o">=</span><span class="si">$(</span><span class="s2">"</span><span class="k">${</span><span class="nv">HELM_INSTALL_DIR</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">BINARY_NAME</span><span class="k">}</span><span class="s2">"</span> version <span class="nt">--template</span><span class="o">=</span><span class="s2">""</span><span class="si">)</span>
    <span class="k">if</span> <span class="o">[[</span> <span class="s2">"</span><span class="nv">$version</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"</span><span class="nv">$TAG</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"Helm </span><span class="k">${</span><span class="nv">version</span><span class="k">}</span><span class="s2"> is already </span><span class="k">${</span><span class="nv">DESIRED_VERSION</span><span class="k">:-</span><span class="nv">latest</span><span class="k">}</span><span class="s2">"</span>
      <span class="k">return </span>0
    <span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"Helm </span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2"> is available. Changing from version </span><span class="k">${</span><span class="nv">version</span><span class="k">}</span><span class="s2">."</span>
      <span class="k">return </span>1
    <span class="k">fi
  else
    return </span>1
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># downloadFile downloads the latest binary package and also the checksum</span>
<span class="c"># for that binary.</span>
downloadFile<span class="o">()</span> <span class="o">{</span>
  <span class="nv">HELM_DIST</span><span class="o">=</span><span class="s2">"helm-</span><span class="nv">$TAG</span><span class="s2">-</span><span class="nv">$OS</span><span class="s2">-</span><span class="nv">$ARCH</span><span class="s2">.tar.gz"</span>
  <span class="nv">DOWNLOAD_URL</span><span class="o">=</span><span class="s2">"https://get.helm.sh/</span><span class="nv">$HELM_DIST</span><span class="s2">"</span>
  <span class="nv">CHECKSUM_URL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$DOWNLOAD_URL</span><span class="s2">.sha256"</span>
  <span class="nv">HELM_TMP_ROOT</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-dt</span> helm-installer-XXXXXX<span class="si">)</span><span class="s2">"</span>
  <span class="nv">HELM_TMP_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HELM_TMP_ROOT</span><span class="s2">/</span><span class="nv">$HELM_DIST</span><span class="s2">"</span>
  <span class="nv">HELM_SUM_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HELM_TMP_ROOT</span><span class="s2">/</span><span class="nv">$HELM_DIST</span><span class="s2">.sha256"</span>
  <span class="nb">echo</span> <span class="s2">"Downloading </span><span class="nv">$DOWNLOAD_URL</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_CURL</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>curl <span class="nt">-SsL</span> <span class="s2">"</span><span class="nv">$CHECKSUM_URL</span><span class="s2">"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$HELM_SUM_FILE</span><span class="s2">"</span>
    curl <span class="nt">-SsL</span> <span class="s2">"</span><span class="nv">$DOWNLOAD_URL</span><span class="s2">"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="nv">$HELM_TMP_FILE</span><span class="s2">"</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_WGET</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>wget <span class="nt">-q</span> <span class="nt">-O</span> <span class="s2">"</span><span class="nv">$HELM_SUM_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$CHECKSUM_URL</span><span class="s2">"</span>
    wget <span class="nt">-q</span> <span class="nt">-O</span> <span class="s2">"</span><span class="nv">$HELM_TMP_FILE</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$DOWNLOAD_URL</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># verifyFile verifies the SHA256 checksum of the binary package</span>
<span class="c"># and the GPG signatures for both the package and checksum file</span>
<span class="c"># (depending on settings in environment).</span>
verifyFile<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VERIFY_CHECKSUM</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>verifyChecksum
  <span class="k">fi
  if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">VERIFY_SIGNATURES</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>verifySignatures
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># installFile installs the Helm binary.</span>
installFile<span class="o">()</span> <span class="o">{</span>
  <span class="nv">HELM_TMP</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HELM_TMP_ROOT</span><span class="s2">/</span><span class="nv">$BINARY_NAME</span><span class="s2">"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$HELM_TMP</span><span class="s2">"</span>
  <span class="nb">tar </span>xf <span class="s2">"</span><span class="nv">$HELM_TMP_FILE</span><span class="s2">"</span> <span class="nt">-C</span> <span class="s2">"</span><span class="nv">$HELM_TMP</span><span class="s2">"</span>
  <span class="nv">HELM_TMP_BIN</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HELM_TMP</span><span class="s2">/</span><span class="nv">$OS</span><span class="s2">-</span><span class="nv">$ARCH</span><span class="s2">/helm"</span>
  <span class="nb">echo</span> <span class="s2">"Preparing to install </span><span class="nv">$BINARY_NAME</span><span class="s2"> into </span><span class="k">${</span><span class="nv">HELM_INSTALL_DIR</span><span class="k">}</span><span class="s2">"</span>
  runAsRoot <span class="nb">cp</span> <span class="s2">"</span><span class="nv">$HELM_TMP_BIN</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$HELM_INSTALL_DIR</span><span class="s2">/</span><span class="nv">$BINARY_NAME</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$BINARY_NAME</span><span class="s2"> installed into </span><span class="nv">$HELM_INSTALL_DIR</span><span class="s2">/</span><span class="nv">$BINARY_NAME</span><span class="s2">"</span>
<span class="o">}</span>

<span class="c"># verifyChecksum verifies the SHA256 checksum of the binary package.</span>
verifyChecksum<span class="o">()</span> <span class="o">{</span>
  <span class="nb">printf</span> <span class="s2">"Verifying checksum... "</span>
  <span class="nb">local sum</span><span class="o">=</span><span class="si">$(</span>openssl sha1 <span class="nt">-sha256</span> <span class="k">${</span><span class="nv">HELM_TMP_FILE</span><span class="k">}</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="si">)</span>
  <span class="nb">local </span><span class="nv">expected_sum</span><span class="o">=</span><span class="si">$(</span><span class="nb">cat</span> <span class="k">${</span><span class="nv">HELM_SUM_FILE</span><span class="k">}</span><span class="si">)</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$sum</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"</span><span class="nv">$expected_sum</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"SHA sum of </span><span class="k">${</span><span class="nv">HELM_TMP_FILE</span><span class="k">}</span><span class="s2"> does not match. Aborting."</span>
    <span class="nb">exit </span>1
  <span class="k">fi
  </span><span class="nb">echo</span> <span class="s2">"Done."</span>
<span class="o">}</span>

<span class="c"># verifySignatures obtains the latest KEYS file from GitHub master branch</span>
<span class="c"># as well as the signature .asc files from the specific GitHub release,</span>
<span class="c"># then verifies that the release artifacts were signed by a maintainer's key.</span>
verifySignatures<span class="o">()</span> <span class="o">{</span>
  <span class="nb">printf</span> <span class="s2">"Verifying signatures... "</span>
  <span class="nb">local </span><span class="nv">keys_filename</span><span class="o">=</span><span class="s2">"KEYS"</span>
  <span class="nb">local </span><span class="nv">github_keys_url</span><span class="o">=</span><span class="s2">"https://raw.githubusercontent.com/helm/helm/master/</span><span class="k">${</span><span class="nv">keys_filename</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_CURL</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>curl <span class="nt">-SsL</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_keys_url</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">keys_filename</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_WGET</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>wget <span class="nt">-q</span> <span class="nt">-O</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">keys_filename</span><span class="k">}</span><span class="s2">"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_keys_url</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">fi
  </span><span class="nb">local </span><span class="nv">gpg_keyring</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/keyring.gpg"</span>
  <span class="nb">local </span><span class="nv">gpg_homedir</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/gnupg"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nt">-m</span> 0700 <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_homedir</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">gpg_stderr_device</span><span class="o">=</span><span class="s2">"/dev/null"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DEBUG</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nv">gpg_stderr_device</span><span class="o">=</span><span class="s2">"/dev/stderr"</span>
  <span class="k">fi
  </span>gpg <span class="nt">--batch</span> <span class="nt">--quiet</span> <span class="nt">--homedir</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">gpg_homedir</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--import</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/</span><span class="k">${</span><span class="nv">keys_filename</span><span class="k">}</span><span class="s2">"</span> 2&gt; <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_stderr_device</span><span class="k">}</span><span class="s2">"</span>
  gpg <span class="nt">--batch</span> <span class="nt">--no-default-keyring</span> <span class="nt">--keyring</span> <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_homedir</span><span class="k">}</span><span class="s2">/pubring.kbx"</span> <span class="nt">--export</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_keyring</span><span class="k">}</span><span class="s2">"</span>
  <span class="nb">local </span><span class="nv">github_release_url</span><span class="o">=</span><span class="s2">"https://github.com/helm/helm/releases/download/</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_CURL</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>curl <span class="nt">-SsL</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_release_url</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256.asc"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256.asc"</span>
    curl <span class="nt">-SsL</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_release_url</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.asc"</span> <span class="nt">-o</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.asc"</span>
  <span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HAS_WGET</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span>wget <span class="nt">-q</span> <span class="nt">-O</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256.asc"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_release_url</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256.asc"</span>
    wget <span class="nt">-q</span> <span class="nt">-O</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.asc"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">github_release_url</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.asc"</span>
  <span class="k">fi
  </span><span class="nb">local </span><span class="nv">error_text</span><span class="o">=</span><span class="s2">"If you think this might be a potential security issue,"</span>
  <span class="nv">error_text</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">error_text</span><span class="k">}</span><span class="se">\n</span><span class="s2">please see here: https://github.com/helm/community/blob/master/SECURITY.md"</span>
  <span class="nb">local </span><span class="nv">num_goodlines_sha</span><span class="o">=</span><span class="si">$(</span>gpg <span class="nt">--verify</span> <span class="nt">--keyring</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">gpg_keyring</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--status-fd</span><span class="o">=</span>1 <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256.asc"</span> 2&gt; <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_stderr_device</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-c</span> <span class="nt">-E</span> <span class="s1">'^\[GNUPG:\] (GOODSIG|VALIDSIG)'</span><span class="si">)</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">num_goodlines_sha</span><span class="k">}</span> <span class="nt">-lt</span> 2 <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Unable to verify the signature of helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.sha256!"</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">error_text</span><span class="k">}</span><span class="s2">"</span>
    <span class="nb">exit </span>1
  <span class="k">fi
  </span><span class="nb">local </span><span class="nv">num_goodlines_tar</span><span class="o">=</span><span class="si">$(</span>gpg <span class="nt">--verify</span> <span class="nt">--keyring</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">gpg_keyring</span><span class="k">}</span><span class="s2">"</span> <span class="nt">--status-fd</span><span class="o">=</span>1 <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">}</span><span class="s2">/helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz.asc"</span> 2&gt; <span class="s2">"</span><span class="k">${</span><span class="nv">gpg_stderr_device</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-c</span> <span class="nt">-E</span> <span class="s1">'^\[GNUPG:\] (GOODSIG|VALIDSIG)'</span><span class="si">)</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="k">${</span><span class="nv">num_goodlines_tar</span><span class="k">}</span> <span class="nt">-lt</span> 2 <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"Unable to verify the signature of helm-</span><span class="k">${</span><span class="nv">TAG</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">OS</span><span class="k">}</span><span class="s2">-</span><span class="k">${</span><span class="nv">ARCH</span><span class="k">}</span><span class="s2">.tar.gz!"</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="k">${</span><span class="nv">error_text</span><span class="k">}</span><span class="s2">"</span>
    <span class="nb">exit </span>1
  <span class="k">fi
  </span><span class="nb">echo</span> <span class="s2">"Done."</span>
<span class="o">}</span>

<span class="c"># fail_trap is executed if an error occurs.</span>
fail_trap<span class="o">()</span> <span class="o">{</span>
  <span class="nv">result</span><span class="o">=</span><span class="nv">$?</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$result</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"0"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    if</span> <span class="o">[[</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$INPUT_ARGUMENTS</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
      </span><span class="nb">echo</span> <span class="s2">"Failed to install </span><span class="nv">$BINARY_NAME</span><span class="s2"> with the arguments provided: </span><span class="nv">$INPUT_ARGUMENTS</span><span class="s2">"</span>
      <span class="nb">help
    </span><span class="k">else
      </span><span class="nb">echo</span> <span class="s2">"Failed to install </span><span class="nv">$BINARY_NAME</span><span class="s2">"</span>
    <span class="k">fi
    </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">For support, go to https://github.com/helm/helm."</span>
  <span class="k">fi
  </span>cleanup
  <span class="nb">exit</span> <span class="nv">$result</span>
<span class="o">}</span>

<span class="c"># testVersion tests the installed client to make sure it is working.</span>
testVersion<span class="o">()</span> <span class="o">{</span>
  <span class="nb">set</span> +e
  <span class="nv">HELM</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">command</span> <span class="nt">-v</span> <span class="nv">$BINARY_NAME</span><span class="si">)</span><span class="s2">"</span>
  <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$?</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"1"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$BINARY_NAME</span><span class="s2"> not found. Is </span><span class="nv">$HELM_INSTALL_DIR</span><span class="s2"> on your "</span><span class="s1">'$PATH?'</span>
    <span class="nb">exit </span>1
  <span class="k">fi
  </span><span class="nb">set</span> <span class="nt">-e</span>
<span class="o">}</span>

<span class="c"># help provides possible cli installation arguments</span>
<span class="nb">help</span> <span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">"Accepted cli arguments are:"</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[--help|-h ] -&gt;&gt; prints this help"</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[--version|-v &lt;desired_version&gt;] . When not defined it fetches the latest release from GitHub"</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">e.g. --version v3.0.0 or -v canary"</span>
  <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[--no-sudo]  -&gt;&gt; install without sudo"</span>
<span class="o">}</span>

<span class="c"># cleanup temporary files to avoid https://github.com/helm/helm/issues/2977</span>
cleanup<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nt">-d</span> <span class="s2">"</span><span class="k">${</span><span class="nv">HELM_TMP_ROOT</span><span class="k">:-}</span><span class="s2">"</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">rm</span> <span class="nt">-rf</span> <span class="s2">"</span><span class="nv">$HELM_TMP_ROOT</span><span class="s2">"</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c"># Execution</span>

<span class="c">#Stop execution on any error</span>
<span class="nb">trap</span> <span class="s2">"fail_trap"</span> EXIT
<span class="nb">set</span> <span class="nt">-e</span>

<span class="c"># Set debug if desired</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">DEBUG</span><span class="k">}</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"true"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">set</span> <span class="nt">-x</span>
<span class="k">fi</span>

<span class="c"># Parsing input arguments (if any)</span>
<span class="nb">export </span><span class="nv">INPUT_ARGUMENTS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="p">@</span><span class="k">}</span><span class="s2">"</span>
<span class="nb">set</span> <span class="nt">-u</span>
<span class="k">while</span> <span class="o">[[</span> <span class="nv">$# </span><span class="nt">-gt</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">do
  case</span> <span class="nv">$1</span> <span class="k">in</span>
    <span class="s1">'--version'</span><span class="p">|</span><span class="nt">-v</span><span class="p">)</span>
       <span class="nb">shift
       </span><span class="k">if</span> <span class="o">[[</span> <span class="nv">$# </span><span class="nt">-ne</span> 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then
           </span><span class="nb">export </span><span class="nv">DESIRED_VERSION</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">}</span><span class="s2">"</span>
       <span class="k">else
           </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Please provide the desired version. e.g. --version v3.0.0 or -v canary"</span>
           <span class="nb">exit </span>0
       <span class="k">fi</span>
       <span class="p">;;</span>
    <span class="s1">'--no-sudo'</span><span class="p">)</span>
       <span class="nv">USE_SUDO</span><span class="o">=</span><span class="s2">"false"</span>
       <span class="p">;;</span>
    <span class="s1">'--help'</span><span class="p">|</span><span class="nt">-h</span><span class="p">)</span>
       <span class="nb">help
       exit </span>0
       <span class="p">;;</span>
    <span class="k">*</span><span class="p">)</span> <span class="nb">exit </span>1
       <span class="p">;;</span>
  <span class="k">esac</span>
  <span class="nb">shift
</span><span class="k">done
</span><span class="nb">set</span> +u

initArch
initOS
verifySupported
checkDesiredVersion
<span class="k">if</span> <span class="o">!</span> checkHelmInstalledVersion<span class="p">;</span> <span class="k">then
  </span>downloadFile
  verifyFile
  installFile
<span class="k">fi
</span>testVersion
cleanup
</code></pre></div></div>

<p><br /></p>

<p>MetalLBì„ ì„¤ì¹˜í•˜ë ¤ë©´ í—¬ë¦„ ì°¨íŠ¸ë¥¼ ë“±ë¡í•  ì£¼ì†Œë¥¼ ì•Œì•„ì•¼ í•œë‹¤. ì•„í‹°íŒ©íŠ¸í—ˆë¸Œ(https://artifacthub.io)ì—ì„œ metallbë¥¼ ê²€ìƒ‰í•´ ì£¼ì†Œë¥¼ í™•ì¸í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-01-52.png" alt="" /></p>

<p><br /></p>

<p>ìƒë‹¨ì— ìœ„ì¹˜í•œ ì•„ì´í…œì„ ëˆŒëŸ¬ metallb ì°¨íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ í™•ì¸í•´ ë³¸ë‹¤. metallb ì•„ì´í…œì„ í´ë¦­í•˜ë©´ ì°¨íŠ¸ì— ëŒ€í•œ ìƒì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-02-39.png" alt="" /></p>

<p><br /></p>

<p>ì´ì œ í—¬ë¦„ ì°¨íŠ¸ ì €ì¥ì†Œì˜ ì£¼ì†Œë„ í™•ì¸í–ˆìœ¼ë‹ˆ ì‹¤ì œë¡œ ì €ì¥ì†Œë¥¼ <strong>helm repo add</strong> ëª…ë ¹ìœ¼ë¡œ ë“±ë¡í•´ì„œ MetalLBë¥¼ ì„¤ì¹˜í•  ì¤€ë¹„ë¥¼ í•œë‹¤. ì—¬ê¸°ì„œ í˜¼ë™ì´ ì˜¬ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ìˆë‹¤. í—¬ë¦„ ì°¨íŠ¸ ì €ì¥ì†Œì¸ <strong>https:iac-source.github.io/helm-chars</strong>ëŠ” ì±… ì €ìê°€ ë§Œë“  ì €ì¥ì†Œë¡œ, ì•„í‹°íŒ©íŠ¸í—ˆë¸Œì—ëŠ” ì´ ê²½ë¡œë§Œì„ í‘œì‹œí•œë‹¤ëŠ” ì ì„ ë‹¤ì‹œ í•œ ë²ˆ ê¸°ì–µí•œë‹¤. ê·¸ë¦¬ê³  eduëŠ” í—¬ë¦„ ì°¨íŠ¸ ì €ì¥ì†Œë¥¼ ëŒ€í‘œí•˜ëŠ” ì´ë¦„ì˜ ì—­í• ì„ í•˜ëŠ” ê²ƒìœ¼ë¡œ ììœ ë¡­ê²Œ ë³€ê²½ ë“±ë¡ì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì±…ì—ì„œëŠ” eduë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ëê¸° ë•Œë¬¸ì— ì´ ì±…ì—ì„œëŠ” eduë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo add edu https://iac-source.github.io/helm-charts
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-05-12.png" alt="" /></p>

<p><br /></p>

<p>í—¬ë¦„ ì°¨íŠ¸ ì €ì¥ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ëëŠ”ì§€ helm repo list ëª…ë ¹ìœ¼ë¡œ ì €ì¥ì†Œ ëª©ë¡ì„ í™•ì¸í•œë‹¤. í™•ì¸í•œ ê²°ê³¼ <strong>edu</strong>ë¼ëŠ” ì´ë¦„ì˜ ì°¨íŠ¸ ì €ì¥ì†Œê°€ ë“±ë¡ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-06-14.png" alt="" /></p>

<p><br /></p>

<p>í—¬ë¦„ìœ¼ë¡œ ì°¨íŠ¸ ì €ì¥ì†Œë¥¼ ì¶”ê°€í•œ ì‹œì ì˜ ì°¨íŠ¸ë¥¼ ë¡œì»¬ ìºì‹œì— ì €ì¥í•´ installê³¼ ê°™ì€ ì‘ì—… ìˆ˜í–‰ì‹œì— ë¨¼ì € ë¡œì»¬ì— ìˆëŠ” ìºì‹œ ì°¨íŠ¸ ì •ë³´ë¥¼ ì°¸ì¡°í•œë‹¤. ë§Œì•½ ì €ì¥ì†Œ ì¶”ê°€ ì´í›„ì— ë³€ê²½ëœ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ë³€ê²½ëœ ì •ë³´ë¥¼ ìºì‹œì— ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ helm repo update ëª…ë ¹ì„ í†µí•´ ìµœì‹  ì°¨íŠ¸ ì •ë³´ë¥¼ ë™ê¸°í™” í•œë‹¤. ì´ëŠ” ê´€ìŠµì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ” ê²ƒìœ¼ë¡œ í˜„ì¬ì˜ ë©ì—ì„œëŠ” í•„ìš”í•œ ìš”ì†ŒëŠ” ì•„ë‹ˆì§€ë§Œ ì§„í–‰í•˜ëŠ” ê²ƒì´ ë‚˜ì¤‘ì— ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>helm repo update
</code></pre></div></div>

<p><br /></p>

<p><img src="/images/Kubernetes/kubernetes-Prometheus/2021-08-09-12-07-55.png" alt="" /></p>

<p><br /></p>

<p>ì•ì„œ ë“±ë¡ ë° ì—…ë°ì´íŠ¸í•œ ì €ì¥ì†Œ eduë¡œë¶€í„° MetalLBë¥¼ ì„¤ì¹˜í•´ë³¸ë‹¤. í—¬ë¦„ ì°¨íŠ¸ë¥¼ ì„¤ì¹˜í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ helm installì´ë©° ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆì™€ ë‹¤ë¥´ê²Œ ì¸ìë¥¼ ë°”ë¡œ ëª…ë ¹ì¤„ì—ì„œ ë°›ì•„ì„œ ì²˜ë¦¬í•œë‹¤. í˜„ì¬ ì‚¬ìš©í•˜ëŠ” ì¸ìëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<ul>
  <li>â€“namespace:</li>
</ul>
:ET