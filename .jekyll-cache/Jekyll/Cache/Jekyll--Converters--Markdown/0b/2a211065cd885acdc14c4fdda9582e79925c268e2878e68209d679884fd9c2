I"ÅL<p><br /><br /></p>

<h1 id="websocketë¥¼-ì´ìš©í•œ-ì±„íŒ…-ì•±-ë§Œë“¤ê¸°-01"><center>WebSocketë¥¼ ì´ìš©í•œ ì±„íŒ… ì•± ë§Œë“¤ê¸°-01</center></h1>

<p><br /></p>

<p>ì¡¸ì—… ì‘í’ˆì„ ìŠ¤í”„ë§ë¶€íŠ¸ë¥¼ ì´ìš©í•´ì„œ ë§Œë“¤ê³  ìˆëŠ” ë„ì¤‘ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì—…ë°ì´íŠ¸ëœ ì •ë³´ë¥¼ ë°›ì•„ì„œ ì°¨íŠ¸ì— ë„ì›Œì£¼ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë ¤ê³  ì—¬ëŸ¬ ìë£Œë“¤ì„ ì°¾ì•„ë´¤ë”ë‹ˆ ë‚˜ì˜¨ ë‹µì´ websocketë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ì˜€ë‹¤. ë¬¼ë¡  ë‹¤ë¥¸ ë°©ë²•ë„ ìˆì—ˆì§€ë§Œ ê·¸ë‚˜ë§ˆ ë³´í¸ì ìœ¼ë¡œ ì“°ì´ëŠ” ê²Œ ì´ ë°©ë²•ì¸ ê²ƒ ê°™ì•„ì„œ websocketë¥¼ ì‚¬ìš©í•˜ì—¬ ì•±ì„ ë§Œë“œëŠ” ì—°ìŠµì„ í•´ë³´ë ¤ê³  í•œë‹¤.</p>

<p><br /></p>

<p><strong><em>â€œí•´ë‹¹ ì•±ì€ â€˜https://ratseno.tistory.com/71â€™ì˜ ë¸”ë¡œê·¸ë¥¼ ë³´ë©´ì„œ ë”°ë¼í•˜ë©° ê³µë¶€í•˜ê¸° ìœ„í•œ ê²ƒì„ì„ ì•Œë¦½ë‹ˆë‹¤. í•´ë‹¹ ë§í¬ì— ì•„ë˜ì— ê±¸ì–´ ë†“ê² ìŠµë‹ˆë‹¤.</em>â€œ</strong></p>

<p><strong><a href="https://ratseno.tistory.com/71">ë¸”ë¡œê·¸ ë§í¬</a></strong></p>

<p><br /></p>

<p>ì‚¬ì‹¤ ì„¸ ê°€ì§€ ë°©ë²• ì¤‘ì—ì„œ ê³ ë¯¼ì„ í•˜ê³  ìˆì—ˆë‹¤.</p>

<ol>
  <li>Firebase</li>
  <li>Ajax</li>
  <li>WebSocket</li>
</ol>

<p><br /></p>

<p>ì•„ ê·¸ë¦¬ê³  ì ˆëŒ€ ì“°ê³  ì‹¶ì§€ ì•Šì€ ë°©ë²•ì¸ ì£¼ê¸°ì ì¸ ìƒˆë¡œê³ ì¹¨â€¦ ì´ê±´ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ ê² ë‹¤ê³  ìƒê°ì„ í–ˆì—ˆë‹¤. ì™œëƒë©´ ë‚´ ìì¡´ì‹¬ì´ í—ˆë½ì„ ì•ˆ í•´ì¤„ë¿ë§Œ ë¶€í•˜ë„ í¬ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<p><br /></p>

<p>ì‹œì‘í•˜ê¸°ì— ì•ì„œ ì¸í…”ë¦¬ì œì´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. ë‚˜ëŠ” í•™ìƒ ì¸ì¦ì„ ë°›ì•„ì„œ ì¸í…”ë¦¬ì œì´ Ultimate ë²„ì ¼ì„ ì“°ê³  ìˆë‹¤.</p>

<p><br /></p>

<p>Group ì´ë¦„ì€ com.techleadë¡œ í•˜ê³  ArtifactëŠ” websocketpracticeë¡œ í•œë‹¤. ì˜ìƒì—ì„œëŠ” Mavenê³¼ Jarë¥¼ ì¼ì§€ë§Œ ë‚˜ëŠ” Gradleë¥¼ Warë¡œ ì„¤ì •í•´ì„œ ì§„í–‰í•œë‹¤. (ì‚¬ì‹¤ Mavenìœ¼ë¡œ í•´ë„ ë¬´ë°©í•˜ë‹¤)</p>

<p><img src="/images/SpringBoot/websocket/2021-03-12-22-43-37.png" alt="" /></p>

<p><br /></p>

<p>ê·¸ë¦¬ê³  ì˜ì¡´ì„± ì„¤ì •ì„ í•´ì¤€ë‹¤.</p>

<ul>
  <li>WebSocket</li>
  <li>Lombok</li>
  <li>Spring Boot DevTools</li>
</ul>

<p><br /></p>

<p>íŒ¨í‚¤ì§€ì™€ ìë°” íŒŒì¼ êµ¬ì„±ì€ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ë‹¤.</p>

<p><img src="/images/SpringBoot/websocket/2021-03-10-22-02-59.png" alt="" /></p>

<p><br /></p>

<p>í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í–ˆìœ¼ë©´ ìë°” ì½”ë“œë¶€í„° ìƒì„±í•œë‹¤. ìš°ë¦¬ëŠ” ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë§Œë“¤ì§€ë§Œ ë°±ì—”ë“œë¶€í„° ë§Œë“¤ì–´ë³´ì, ë°±ì—”ë“œë¥¼ ë§Œë“œëŠ” ê²ƒì´ ë” ì‰½ê¸° ë•Œë¬¸ì´ë‹¤. ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ íŒ¨í‚¤ì§€ì™€ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“ ë‹¤.</p>

<p><img src="/images/SpringBoot/websocket/2021-03-12-22-45-31.png" alt="" /></p>

<p><br /></p>

<p>config íŒ¨í‚¤ì§€ì— ìˆëŠ” ìë°” íŒŒì¼ë¶€í„° ì½”ë“œë¥¼ ìƒì„±í•´ë³´ì. WebSocketMessageBrokerConfigurer ì¸í„°í˜ì´ìŠ¤ëŠ” ë””í´íŠ¸ ë©”ì„œë“œê°€ ìˆê¸° ë•Œë¬¸ì— <strong>registerStompEndpoints</strong>ì™€ <strong>configureMessageBroker</strong>ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•´ì¤€ë‹¤.</p>

<p><strong>WebsocketConfiguration.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.techlead.websocketpractice.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.messaging.simp.config.MessageBrokerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.socket.config.annotation.StompEndpointRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@EnableWebSocketMessageBroker</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSocketConfig</span> <span class="kd">implements</span> <span class="nc">WebSocketMessageBrokerConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerStompEndpoints</span><span class="o">(</span><span class="nc">StompEndpointRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"end point ì—°ê²°!!!***"</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addEndpoint</span><span class="o">(</span><span class="s">"/ws"</span><span class="o">).</span><span class="na">withSockJS</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureMessageBroker</span><span class="o">(</span><span class="nc">MessageBrokerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"confiureMessageBroker ì—°ë™!!**"</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">setApplicationDestinationPrefixes</span><span class="o">(</span><span class="s">"/app"</span><span class="o">);</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">enableSimpleBroker</span><span class="o">(</span><span class="s">"/topic"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>


</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p><strong>@Configuration</strong> ì–´ë…¸í…Œì´ì…˜ì€ í•´ë‹¹ í´ë˜ìŠ¤ê°€ Beanì˜ ì„¤ì •ì„ í•  ê²ƒì´ë¼ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ë©° <strong>@EnableWebSocketMessageBroker</strong>ëŠ” WebSocket ì„œë²„ë¥¼ í™œì„±í™”ì‹œí‚¨ë‹¤. <strong>WebSocketMessageBrokerConfigurer</strong> ì¸í„°í˜ì´ìŠ¤ëŠ” ì›¹ ì†Œì¼“ ì—°ê²°ì„ êµ¬ì„±í•˜ê¸° ìœ„í•œ ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤. ë‚˜ì¤‘ì— í”„ë¡ íŠ¸ì—”ë“œì—ì„œ sockJS ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ì„œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì„¤ì •í•´ì•¼ í•˜ëŠ”ë° ì´ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •ì„ <strong>registerStompEndpoints</strong> ë©”ì„œë“œì—ì„œ ì„¤ì •í•œë‹¤. ì¦‰ ì´ ë©”ì„œë“œì—ì„œëŠ” í´ë¼ì´ì–¸íŠ¸ì—ì„œ websocketì— ì ‘ì†í•˜ëŠ” endpointë¥¼ ë“±ë¡í•œë‹¤. <strong>configureMessageBroker</strong> ë©”ì„œë“œëŠ” í•œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ë¡œ ë©”ì‹œì§€ë¥¼ ë¼ìš°íŒ… í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¸Œë¡œì»¤ë¥¼ êµ¬ì„±í•œë‹¤. ì—¬ê¸°ì„œ <strong>/app</strong>ìœ¼ë¡œ ì‹œì‘ë˜ëŠ” ë©”ì‹œì§€ë§Œ ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë¡œ ë¼ìš°íŒ…í•œë‹¤ê³  ì •ì˜í•œë‹¤. <strong>/topic</strong>ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì£¼ì œë¥¼ ê°€ì§„ ë©”ì‹œì§€ë¥¼ í•¸ë“¤ëŸ¬ë¡œ ë¼ìš°íŒ…í•˜ì—¬ í•´ë‹¹ ì£¼ì œì— ê°€ì…í•œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë°©ì†¡í•œë‹¤.
ì´ ê²½ë¡œëŠ” ì°¨í›„ì— ì•„ë˜ì™€ ê°™ì´ ì“°ì¼ ê²ƒì´ë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    <span class="nx">stompClient</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="dl">'</span><span class="s1">/topic/public</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onMessageReceived</span><span class="p">);</span>
    <span class="nx">stompClient</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">/app/chat.addUser</span><span class="dl">"</span><span class="p">,</span>
        <span class="p">{},</span>
        <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="na">sender</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">JOIN</span><span class="dl">'</span><span class="p">})</span>
    <span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ì´ì œ model íŒ¨í‚¤ì§€ì˜ íŒŒì¼ë“¤ì— ì½”ë“œë¥¼ ì¶”ê°€í•´ë³´ì. ChatMessage í´ë˜ìŠ¤ëŠ” ë©”ì‹œì§€ íƒ€ì…, ë©”ì‹œì§€ ë‚´ìš© ê·¸ë¦¬ê³  ì†¡ì‹ ìë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤. MessageType Enumí´ë˜ìŠ¤ëŠ” ë©”ì‹œì§€ íƒ€ì…ì„ ëª…ì‹œí•œë‹¤.</p>

<p><strong>ChatMessage.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.techlead.websocketpractice.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChatMessage</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">MessageType</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">content</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">sender</span><span class="o">;</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>@Data ì–´ë…¸í…Œì´ì…˜ì€ í•´ë‹¹ í•„ë“œë“¤ì˜ setterì™€ getterë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ì•„ì£¼ í¸ë¦¬í•œ ë¡¬ë³µ ì–´ë…¸í…Œì´ì…˜ì´ë‹ˆ ì•Œì•„ë‘ë„ë¡ í•˜ì.</p>

<p><strong>MessageType Enum</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.techlead.websocketpractice.model</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">MessageType</span> <span class="o">{</span>
    <span class="no">CHAT</span><span class="o">,</span>
    <span class="no">JOIN</span><span class="o">,</span>
    <span class="no">LEAVE</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>
<p><br /></p>

<p>ë©”ì‹œì§€ íƒ€ì…ì€ ë§ ê·¸ëŒ€ë¡œ ì±„íŒ… í• ë•Œ, ìƒˆë¡­ê²Œ ì±„íŒ… ë°©ì— ë“¤ì–´ì˜¬ ë•Œ ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ì±„íŒ…ë°©ì„ ë– ë‚  ë•Œë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.</p>

<p>controller íŒ¨í‚¤ì§€ì˜ WebSocketEventListener ìë°” í´ë˜ìŠ¤ì— ì½”ë“œë¥¼ ì¶”ê°€í•´ë³´ì.</p>

<p><strong>WebSocketEventListener.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">com.techlead.websocketpractice.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.techlead.websocketpractice.model.ChatMessage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.techlead.websocketpractice.model.MessageType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.event.EventListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.messaging.simp.SimpMessageSendingOperations</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.messaging.simp.stomp.StompHeaderAccessor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.socket.messaging.SessionConnectedEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.socket.messaging.SessionDisconnectEvent</span><span class="o">;</span>


<span class="c1">//event listenerë¥¼ ì´ìš©í•´ì„œ ì†Œì¼“ ì—°ê²°(socket connect) ê·¸ë¦¬ê³  ì†Œì¼“ ì—°ê²° ëŠê¸°(disconnect)</span>
<span class="c1">//ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì‹ í•˜ì—¬ ì‚¬ìš©ìê°€ ì±„íŒ…ë°©ì„ ì°¸ì—¬(JOIN)í•˜ê±°ë‚˜ ë– ë‚ ë•Œ(LEAVE)ì˜ ì´ë²¤íŠ¸ë¥¼ logging í•˜ê±°ë‚˜ broadcastí•  ìˆ˜ ìˆë‹¤.</span>

<span class="c1">//ì´ ì–´ë…¸í…Œì´ì…˜ì€ ìë°” í´ë˜ìŠ¤ë¥¼ ìŠ¤í”„ë§ ë¹ˆì´ë¼ê³  í‘œì‹œí•˜ëŠ” ì—­í• ì„ í•œë‹¤. ì´ ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨</span>
<span class="c1">//ìŠ¤í”„ë§ì˜ component-scanning ê¸°ìˆ ì´ ì´ í´ë˜ìŠ¤ë¥¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì— ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê²Œ ëœë‹¤.</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSocketEventListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">WebSocketEventListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">SimpMessageSendingOperations</span> <span class="n">messagingTemplate</span><span class="o">;</span>
    <span class="nd">@EventListener</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleWebSocketConnectListener</span><span class="o">(</span><span class="nc">SessionConnectedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"connected listener"</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Received a new web socket connection"</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@EventListener</span>
    <span class="c1">//ë‘ë²ˆì§¸ ë©”ì„œë“œì¸ SessionDisconnect ì´ë²¤íŠ¸ì—ì„œëŠ”</span>
    <span class="c1">// //ì›¹ ì†Œì¼“ ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì´ë¦„ì„ ì¶”ì¶œí•˜ê³  ì—°ê²°ëœ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ</span>
    <span class="c1">// ì‚¬ìš©ì í‡´ì¥ ì´ë²¤íŠ¸ë¥¼ broadcastí•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleWebSocketDisconnectListener</span><span class="o">(</span><span class="nc">SessionDisconnectEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"disconnected listener"</span><span class="o">);</span>
        <span class="nc">StompHeaderAccessor</span> <span class="n">headerAccessor</span> <span class="o">=</span> <span class="nc">StompHeaderAccessor</span><span class="o">.</span><span class="na">wrap</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">headerAccessor</span><span class="o">.</span><span class="na">getSessionAttributes</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">username</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"User Disconnected : "</span> <span class="o">+</span> <span class="n">username</span><span class="o">);</span>

            <span class="nc">ChatMessage</span> <span class="n">chatMessage</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ChatMessage</span><span class="o">();</span>
            <span class="n">chatMessage</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="nc">MessageType</span><span class="o">.</span><span class="na">LEAVE</span><span class="o">);</span>
            <span class="n">chatMessage</span><span class="o">.</span><span class="na">setSender</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>

            <span class="n">messagingTemplate</span><span class="o">.</span><span class="na">convertAndSend</span><span class="o">(</span><span class="s">"/topic/public"</span><span class="o">,</span> <span class="n">chatMessage</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ìŠ¤í”„ë§ 4.2ë¶€í„°ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ApplicationListener ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” Beanì¼ í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤. <strong>@EventListener</strong> ì£¼ì„ì„ í†µí•´ì„œ ê´€ë¦¬ë˜ëŠ” Beanì˜ ëª¨ë“  public ë©”ì†Œë“œì— ë“±ë¡ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆê³  í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì€ Beanìœ¼ë¡œ ë“±ë¡ëœ Classì˜ ë©”ì„œë“œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. <strong>handleWebSocketConnectListener</strong> ë©”ì†Œë“œëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì›¹ì†Œì¼“ì— ì—°ê²°ë˜ì—ˆì„ ë•Œ í˜¸ì¶œëœë‹¤. ì—¬ê¸°ì„œëŠ”  ìš°ë¦¬ëŠ” ì¢€ ìˆë‹¤ê°€ ChatControllerì—ì„œ addUser() ë©”ì†Œë“œë¥¼ í†µí•´ ì‚¬ìš©ì ì°¸ì—¬ ì´ë²¤íŠ¸ë¥¼ broadcastí•  ê²ƒì„ìœ¼ë¡œ ì—¬ê¸°ì„œëŠ” ë³„ë‹¤ë¥¸ ë™ì‘ì—†ì´ ë¡œê¹… ì²˜ë¦¬ë§Œ í•œë‹¤. <strong>handleWebSocketDisconnectListener</strong> ë©”ì†Œë“œëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ê²°ì´ ëŠê²¼ì„ ë•Œ í˜¸ì¶œì´ ë˜ëŠ” ë©”ì„œë“œì´ë‹¤. ì—¬ê¸°ì„œëŠ” ì›¹ ì†Œì¼“ ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ì´ë¦„ì„ ì¶”ì¶œí•˜ê³  ì—°ê²°ëœ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì‚¬ìš©ì í‡´ì¥ ì´ë²¤íŠ¸ë¥¼ ë°©ì†¡(broadcast)í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.</p>

:ET