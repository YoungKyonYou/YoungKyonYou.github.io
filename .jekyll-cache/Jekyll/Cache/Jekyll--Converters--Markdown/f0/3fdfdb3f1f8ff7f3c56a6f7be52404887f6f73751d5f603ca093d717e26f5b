I"<p><span style="color:orange; font-weight:bold"><em>해당 내용은 책 ‘코드로 배우는 스프링 부트 웹 프로젝트’에 나오는 내용이며 이는 개인적으로 공부하기 위해 기록함을 알려드립니다</em></span></p>

<p><br /><br /></p>

<h1 id="자동-회원-가입의-후처리"><center>자동 회원 가입의 후처리</center></h1>

<p><br /></p>

<p>이제 자동으로 회원 가입이 되는 경우에는 다음과 같은 점들을 좀 고민해봐야 한다.</p>

<link rel="stylesheet" href="https: //www.webnots.com/resources/font-awesome/css/font-awesome.min.css" />

<link rel="stylesheet" href="/assets/css/webnots.css" />

<div class="webnots-success webnots-notification-box">패스워드가 모두 '1111'로만 처리되는 점 - 만일 이메일을 알고 있다면 모든 패스워드는 1111로 고정되는 단점</div>
<div class="webnots-success webnots-notification-box">사용자의 이메일(email) 외에도 이름(name)을 닉네임처럼 사용할 수 없다는 점</div>

<p><br /></p>

<p>다행이도 현재 코드에는 fromSocial이라는 속성값을 이용한다.</p>

<p><br /></p>

<div class="webnots-success webnots-notification-box">폼방식의 로그인은 fromSocial 값이 false인 경우에만 로그인이 가능</div>
<div class="webnots-success webnots-notification-box">소셜의 경우에는 fromSocial 값이 true인 해당 이메일을 가진 사용자 조회</div>

<p><br /></p>

<p>위와 같은 방식을 이용해서 소셜로 가입한 이메일이 있더라도 일반적인 폼방식으로 로그인이 불가능하도록 처리한다. 아래 그림은 소셜 계정으로 로그인하는 경우에 로그인이 실패하는 화면이다.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-11.3/2021-08-04-18-17-58.png" alt="" /></p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-11.3/2021-08-04-18-18-18.png" alt="" /></p>

<p><br /></p>

<p>만일 소셜 로그인을 한 사용자에 한해서 서비스에서 사용할 본인의 이름이나 패스워드를 수정하고자 한다면 로그인 이후에 폼 로그인과 달리 회원 정보를 수정할 수 있는 페이지로 이동할 필요가 있다.</p>

<p><br /></p>

<p>스프링 시큐리티의 로그인 관련 처리에는 <strong>AuthenticationSuccessHandler</strong>와 <strong>AuthenticationFailureHandler</strong>라는 인터페이스를 제공한다. 인터페이스의 이름에서 짐작할 수 있듯이 인증이 성공하거나 실패한 후에 처리를 지정하는 용도로 사용한다. HttpSecurity의 formLogin()이나 oauth2Login() 후에는 이러한 핸들러를 설정할 수 있다. 예제는 oauth2Login() 이후에 이를 적용한다고 가정한다. security 패키지 내에 handler라는 패키지를 추가하고 ClubLoginSuccessHandler라는 클래스를 추가한다.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-11.3/2021-08-04-18-58-32.png" alt="" /></p>
:ET