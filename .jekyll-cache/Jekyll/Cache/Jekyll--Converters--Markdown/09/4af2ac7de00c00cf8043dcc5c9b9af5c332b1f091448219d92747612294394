I"ÔT<p><br /><br /></p>

<p><strong><em>í•´ë‹¹ ë‚´ìš©ì€ ì±… &lt;ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½ êµ¬ì¶•ì„ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤/ë„ì»¤&gt;ì— ë‚˜ì˜¤ëŠ” ë‚´ìš©ì´ë©° ì´ëŠ” ê°œì¸ì ìœ¼ë¡œ ê³µë¶€í•˜ê¸° ìœ„í•´ì„œ ê²Œì‹œí•˜ëŠ” ê¸€ì„ì„ ì•Œë¦½ë‹ˆë‹¤.</em></strong></p>

<p><br /><br />
<em><strong>ì»¤í”¼ ì¤‘ë…ìë˜ëŠ” ì¤‘â€¦</strong></em>
<br />
(Press the Button)</p>

<p><br /><br /></p>

<style>
.containercoffee {
  width: 300px;
  height: 280px;
  position: relative;
  top: calc(50% - 140px);
  left: calc(50% - 150px);
}
.coffee-header {
  width: 100%;
  height: 80px;
  position: absolute;
  top: 0;
  left: 0;
  background-color: #ddcfcc;
  border-radius: 10px;
}
.coffee-header__buttons {
  width: 25px;
  height: 25px;
  position: absolute;
  top: 25px;
  background-color: #282323;
  border-radius: 50%;
}
.coffee-header__buttons::after {
  content: "";
  width: 8px;
  height: 8px;
  position: absolute;
  bottom: -8px;
  left: calc(50% - 4px);
  background-color: #615e5e;
}
.coffee-header__button-one {
  left: 15px;
}
.coffee-header__button-two {
  left: 50px;
}
.coffee-header__display {
  width: 50px;
  height: 50px;
  position: absolute;
  top: calc(50% - 25px);
  left: calc(50% - 25px);
  border-radius: 50%;
  background-color: #9acfc5;
  border: 5px solid #43beae;
  box-sizing: border-box;
}
.coffee-header__details {
  width: 8px;
  height: 20px;
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #9b9091;
  box-shadow: -12px 0 0 #9b9091, -24px 0 0 #9b9091;
}
.coffee-medium {
  width: 90%;
  height: 160px;
  position: absolute;
  top: 80px;
  left: calc(50% - 45%);
  background-color: #bcb0af;
}
.coffee-medium:before {
  content: "";
  width: 90%;
  height: 100px;
  background-color: #776f6e;
  position: absolute;
  bottom: 0;
  left: calc(50% - 45%);
  border-radius: 20px 20px 0 0;
}
.coffe-medium__exit {
  width: 60px;
  height: 20px;
  position: absolute;
  top: 0;
  left: calc(50% - 30px);
  background-color: #231f20;
}
.coffe-medium__exit::before {
  content: "";
  width: 50px;
  height: 20px;
  border-radius: 0 0 50% 50%;
  position: absolute;
  bottom: -20px;
  left: calc(50% - 25px);
  background-color: #231f20;
}
.coffe-medium__exit::after {
  content: "";
  width: 10px;
  height: 10px;
  position: absolute;
  bottom: -30px;
  left: calc(50% - 5px);
  background-color: #231f20;
}
.coffee-medium__arm {
  width: 70px;
  height: 20px;
  position: absolute;
  top: 15px;
  right: 25px;
  background-color: #231f20;
}
.coffee-medium__arm::before {
  content: "";
  width: 15px;
  height: 5px;
  position: absolute;
  top: 7px;
  left: -15px;
  background-color: #9e9495;
}
.coffee-medium__cup {
  width: 80px;
  height: 47px;
  position: absolute;
  bottom: 0;
  left: calc(50% - 40px);
  background-color: #FFF;
  border-radius: 0 0 70px 70px / 0 0 110px 110px;
}
.coffee-medium__cup::after {
  content: "";
  width: 20px;
  height: 20px;
  position: absolute;
  top: 6px;
  right: -13px;
  border: 5px solid #FFF;
  border-radius: 50%;
}
@keyframes liquid {
  0% {
    height: 0px;  
    opacity: 1;
  }
  5% {
    height: 0px;  
    opacity: 1;
  }
  20% {
    height: 62px;  
    opacity: 1;
  }
  95% {
    height: 62px;
    opacity: 1;
  }
  100% {
    height: 62px;
    opacity: 0;
  }
}
.coffee-medium__liquid {
  width: 6px;
  height: 63px;
  opacity: 0;
  position: absolute;
  top: 50px;
  left: calc(50% - 3px);
  background-color: #74372b;
  animation: liquid 4s 4s linear infinite;
}
.coffee-medium__smoke {
  width: 8px;
  height: 20px;
  position: absolute;  
  border-radius: 5px;
  background-color: #b3aeae;
}
@keyframes smokeOne {
  0% {
    bottom: 20px;
    opacity: 0;
  }
  40% {
    bottom: 50px;
    opacity: .5;
  }
  80% {
    bottom: 80px;
    opacity: .3;
  }
  100% {
    bottom: 80px;
    opacity: 0;
  }
}
@keyframes smokeTwo {
  0% {
    bottom: 40px;
    opacity: 0;
  }
  40% {
    bottom: 70px;
    opacity: .5;
  }
  80% {
    bottom: 80px;
    opacity: .3;
  }
  100% {
    bottom: 80px;
    opacity: 0;
  }
}
.coffee-medium__smoke-one {
  opacity: 0;
  bottom: 50px;
  left: 102px;
  animation: smokeOne 3s 4s linear infinite;
}
.coffee-medium__smoke-two {
  opacity: 0;
  bottom: 70px;
  left: 118px;
  animation: smokeTwo 3s 5s linear infinite;
}
.coffee-medium__smoke-three {
  opacity: 0;
  bottom: 65px;
  right: 118px;
  animation: smokeTwo 3s 6s linear infinite;
}
.coffee-medium__smoke-for {
  opacity: 0;
  bottom: 50px;
  right: 102px;
  animation: smokeOne 3s 5s linear infinite;
}
.coffee-footer {
  width: 95%;
  height: 15px;
  position: absolute;
  bottom: 25px;
  left: calc(50% - 47.5%);
  background-color: #41bdad;
  border-radius: 10px;
}
.coffee-footer::after {
  content: "";
  width: 106%;
  height: 26px;
  position: absolute;
  bottom: -25px;
  left: -8px;
  background-color: #000;
}
</style>

<div class="containercoffee">
    <div class="coffee-header">
      <div class="coffee-header__buttons coffee-header__button-one"></div>
      <div class="coffee-header__buttons coffee-header__button-two"></div>
      <div class="coffee-header__display"></div>
      <div class="coffee-header__details"></div>
    </div>
    <div class="coffee-medium">
      <div class="coffe-medium__exit"></div>
      <div class="coffee-medium__arm"></div>
      <div class="coffee-medium__liquid"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-one"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-two"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-three"></div>
      <div class="coffee-medium__smoke coffee-medium__smoke-for"></div>
      <div class="coffee-medium__cup"></div>
    </div>
    <div class="coffee-footer"></div>
</div>

<p><br /><br /><br /><br /><br /><br /><br /><br /></p>

<h1 id="pvì™€-pvc"><center>PVì™€ PVC</center></h1>

<p><br /></p>

<p>ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” <span style="color:orange; font-weight:bold">ì»¨í…Œì´ë„ˆ ì¸í”„ë¼ í™˜ê²½ êµ¬ì¶•ì„ ìœ„í•œ ì¿ ë²„ë„¤í‹°ìŠ¤/ë„ì»¤</span> ì±…ì˜ ì €ìê°€ ë§Œë“  <span style="color:orange; font-weight:bold">Kubernetes All-in-One Cluster Monitoring KR</span>ì„ í•˜ë‚˜í•˜ë‚˜ ë¶„ì„í•´ ë³´ë ¤ í•œë‹¤. ë‚˜ì¤‘ì— ë‚´ê°€ ì¨ì•¼í•  ì¼ì´ ìˆì„ ìˆ˜ë„ ìˆê³  ë¶„ì„í•¨ìœ¼ë¡œì¨ ë‚˜ì¤‘ì— ë‚´ê°€ ë‚´ê²ƒì„ ì§ì ‘ ë§Œë“œëŠ”ë° ë§ì€ ë„ì›€ì´ ë  ê²ƒ ê°™ì•„ì„œë‹¤.</p>

<p><strong>Kubernetes All-in-One Cluster Monitoring</strong></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-17-10-20-02.png" alt="" /></p>

<p><br /></p>

<p>ìœ„ ì‚¬ì§„ì—ì„œ ë‚˜ì˜¤ëŠ” ëŒ€ì‹œë³´ë“œë¥¼ ì°¨ë¡€ëŒ€ë¡œ ë´ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-17-10-25-52.png" alt="" /></p>

<p><br /></p>

<p>ìœ„ ëŒ€ì‹œë³´ë“œì™€ ê´€ë ¨í•œ ê¸°ë³¸ì •ë³´ëŠ” ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ë‹¤.</p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-17-10-26-55.png" alt="" /></p>

<p><br /></p>

<p>ì•„ë§ˆ ë©”íŠ¸ë¦­ êµ¬ì„±(PromQL)ì„ ë¶„ì„í•˜ëŠ” ê²ƒì´ ì œì¼ ì–´ë ¤ìš¸ ë“¯ ì‹¶ë‹¤. í•˜ì§€ë§Œ ì²œì²œíˆ í•˜ë‚˜í•˜ë‚˜ ì•Œì•„ê°€ ë³´ì.</p>

<p><br /></p>

<p>ë©”íŠ¸ë¦­ì€ PromQL(Prometheus Query Language)ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤.</p>

<p><br /></p>

<pre><code class="language-PromQL">avg(
avg_over_time((sum without ()(kube_pod_container_status_ready{namespace="kube-system",pod=~".*.dashboard.*|.*.dns.*|kube.*|.*.calico.*|.*.flannel.*|.*.etcd.*"})
/
count without ()(kube_pod_container_status_ready{namespace="kube-system",pod=~".*.dashboard.*|.*.dns.*|kube.*|.*.calico.*|.*.flannel.*|.*.etcd.*"}))[$duration:5m])
)
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">avg()</span>: í‰ê· ê°’ì„ ë°˜í™˜í•œë‹¤.<br /><br /></li>
  <li><span style="color:#3D9970; font-weight:bold">avg_over_time()</span>: ì§€ì •ëœ ê°„ê²©ì— ìˆëŠ” ëª¨ë“  í¬ì¸íŠ¸ì˜ í‰ê·  ê°’ì„ ë°˜í™˜í•œë‹¤. <br /><br /></li>
  <li><span style="color:#3D9970; font-weight:bold">sum</span>: í•©ê³„ë¥¼ ë°˜í™˜ <br /><br /></li>
  <li><span style="color:#3D9970; font-weight:bold">without</span>: byë„ ìˆëŠ”ë° withoutê³¼ group byì™€ ê°™ì€ ì—­í• ì„ í•œë‹¤. withoutì€ byì˜ ë°˜ëŒ€ ê´€ê³„ì´ë‹¤. ì¦‰ withoutì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ labelì€ ì œì™¸í•˜ê³  ë‚˜ë¨¸ì§€ë¡œ group byë¥¼ í•œë‹¤.<br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

group byëŠ” ìœ í˜•ë³„ë¡œ ê°¯ìˆ˜ë¥¼ ì•Œê³  ì‹¶ì„ ë•Œ ì»¬ëŸ¼ì— ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ê²Œ í•´ì¤€ë‹¤.<br /><br />
ì˜ˆë¥¼ ë“¤ì–´ process_countì— groupì´ë¼ëŠ” ë¼ë²¨ì´ ìˆë‹¤ê³  í•  ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br /><br /> <span style="color:orange; font-weight:bold">sum (process_count_total) without (group)</span><br /><br />
ì´ëŸ° ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ í•  ì ì€ by ë˜ëŠ” without ë‹¤ìŒì— ì˜¤ëŠ” label listëŠ” ê´„í˜¸ë¡œ ë¬¶ì—¬ì•¼ í•˜ë‹¤ëŠ” ì ì´ë‹¤. ê´„í˜¸ë¡œ ë¬¶ì§€ ì•Šìœ¼ë©´ ì •ìƒì ì¸ ì¿¼ë¦¬ë¬¸ì´ ì•„ë‹ˆê²Œ ëœë‹¤. ì¶”ê°€ë¡œ vector expressionì´ ê¸¸ë‹¤ë©´ by ë˜ëŠ” without êµ¬ë¬¸ì„ ì•ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. <br /><br />
<span style="color:orange; font-weight:bold">sum by (group) (process_count_total)</span><br /><br />
ì—¬ê¸°ì„œëŠ” ì´ í˜•ì‹ì„ ì‚¬ìš©í–ˆë‹¤.</div>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">kube_pod_container_status_ready</span>: ì»¨í…Œì´ë„ˆì˜ ì¤€ë¹„ í™•ì¸ì´ ì„±ê³µí–ˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì„¤ëª…í•œë‹¤.(í¼ì„¼í‹°ì§€ë¡œ í‘œì‹œ)<br /><br /></li>
  <li><span style="color:#3D9970; font-weight:bold">namespace=â€kube-systemâ€</span>: í˜„ì¬ ë‚´ í´ëŸ¬ìŠ¤í„° ë‚´ì— ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¤‘ â€œkube-systemâ€ë¥¼ ì˜ë¯¸í•œë‹¤.<br /><br />
    <link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

    <div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

superputtyì—ì„œ<br /><span style="color:orange; font-weight:bold">kubectl get namespace</span><br />
ë¥¼ ì…ë ¥í•˜ë©´ "kube-system"ì´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</div>

    <p><br /></p>
  </li>
  <li><span style="color:#3D9970; font-weight:bold">=~</span>: ì •ê·œì‹ í‘œí˜„ì„ ì´ìš©í•  ìˆ˜ ìˆëŠ” operatorì´ë‹¤.<br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

\*: ì• ë¬¸ìê°€ 0ê°œ ì´ìƒì˜ ê°œìˆ˜ê°€ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.<br /><br />
.: ì„ì˜ì˜ ë¬¸ì [ë‹¨ '`ëŠ” ë„£ì„ ìˆ˜ ì—†ë‹¤.]<br /><br />
|: íŒ¨í„´ì„ OR ì—°ì‚°ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•œë‹¤.</div>
<p><br /><br />
ì¦‰ ì—¬ê¸°ì„œëŠ” í´ëŸ¬ìŠ¤í„°ë‚´ kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ìˆëŠ” íŒŒë“œ ì¤‘ì— dashboard, dns, kube, calico, flannel, etcdë¼ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ê°€ ìˆëŠ” íŒŒë“œë¥¼ ëª¨ë‘ ì„ íƒí•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">[$duration: 5m]</span>: $ í‘œì‹œëŠ” ë¯¸ë¦¬ ë“±ë¡í•œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤. ëŒ€ì‹œë³´ë“œì˜ settingì— ë“¤ì–´ê°€ë©´ ë³€ìˆ˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

Range Vector: Range VectorëŠ” ì¿¼ë¦¬ ì‹œì ê¹Œì§€ Time durationì— ëŒ€í•´ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ì‹œê³„ì—´ì„ ê°€ì§€ê³  ìˆë‹¤. ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´ Instant Vectorì— []ë¼ëŠ” Range Vector Selectorë¥¼ ì‚¬ìš©í•œ ë°ì´í„°ë¼ê³  ë³´ë©´ ëœë‹¤. ì—¬ê¸°ì„œ [] ì•ˆì´ 5mìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆëŠ”ë° ì´ëŠ” 5ë¶„ì˜ ê°„ê²©ì„ ì˜ë¯¸í•œë‹¤. ì¦‰ ì•ì—ì„œ avg_over_time()ë¥¼ ì‚¬ìš©í–ˆì—ˆëŠ”ë° 5ë¶„ì„ ê°„ê²©ìœ¼ë¡œ í‰ê· ì„ ì§‘ê³„í•´ì£¼ëŠ” í•¨ìˆ˜ì´ë‹¤.</div>

<p><br /></p>

<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

avg()ì™€ avg_over_time()[]ì„ ì§€ìš°ë©´ ì•„ë˜ì™€ ê°™ì€ ì‚¬ì§„ì´ ë‚˜ì˜¨ë‹¤.</div>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-10-17-05.png" alt="" /></p>

<p><br /></p>

<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

í•´ë‹¹ ì •ê·œì‹ í‘œí˜„ì— ì•Œë§ëŠ” íŒŒë“œë“¤ì˜ ê° ìƒíƒœì •ë³´ê°€ ìˆ˜ì§‘ë˜ê³  ì´ ê°ê°ì˜ íŒŒë“œì˜ 5ë¶„ ê°„ê²©ì˜ ì‹œê³„ì—´ ë°ì´í„°ì˜ í‰ê· ì„ avg_over_time() í•¨ìˆ˜ë¡œ ì§‘ê³„í•˜ê³  ë‹¤ì‹œ ê·¸ê²ƒì„ avg() í‰ê· ì„ êµ¬í•´ì„œ í‘œì‹œí•œë‹¤.

ì£¼ì˜í•  ê²ƒì€ 100%ì€ 1ì„ ì˜ë¯¸í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ê²Œ ë¬´ìŠ¨ ë§ì´ëƒë©´ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ 0~1 ê°’ì„ ê°€ì§€ê²Œ í•„ë“œë¥¼ ì„¤ì •í•´ ë†¨ë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ë‚˜ëˆ„ê¸°ë¥¼ í•˜ë©´ 1/1=1ì´ ë‚˜ì™€ì„œ 100%ê°€ ëœë‹¤.</div>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-11-06-43.png" alt="" /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">/</span>: ì‚°ìˆ  ì—°ì‚°ìì—ì„œ ë‚˜ëˆ„ê¸°ë¥¼ ì˜ë¯¸<br /><br /></li>
</ul>

<hr />

<p>ë‹¤ìŒ ì§€í‘œë¥¼ ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-11-17-50.png" alt="" /></p>

<p><br /></p>

<p>ë‹¤ìŒì€ ì‰½ë‹¤ ê·¸ëƒ¥ í´ëŸ¬ìŠ¤í„°ë‚´ì— ì¡´ì¬í•˜ëŠ” namespaceì˜ ê°œìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</p>

<p><br /></p>

<pre><code class="language-PromQL"> count(kube_namespace_created)
</code></pre>

<p><br /></p>

<hr />

<p>ë‹¤ìŒ ì§€í‘œëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  podì˜ ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.</p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-11-19-24.png" alt="" /></p>

<p><br /></p>

<pre><code class="language-PromQL"> count(count by (pod)(container_spec_memory_reservation_limit_bytes{pod!=""}))
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">container_spec_memory_reservation_limit_bytes</span>: ì»¨í…Œì´ë„ˆê°€ ì˜ˆì•½í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ í•œê³„ë¥¼ í‘œì‹œí•œë‹¤.<br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ container_spec_memory_reservation_limit_bytesê°€ ì•„ë‹ˆë‹¤. ì´ê²ƒì€ ë‹¨ì§€ ëª¨ë“  íŒŒë“œë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•œ í•œ ë°©ë²•ìœ¼ë¡œì„œë§Œ ì‚¬ìš©ëœ ê²ƒì´ë‹¤. ì¦‰ ì—¬ê¸°ì„  íŒŒë“œë“¤ì˜ ì–´ë–¤ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•œ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ì¨ë„ ë¬´ë°©í•˜ë‹¤. ì•„ë˜ ì‚¬ì§„ì— ë‚˜ì˜¤ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ ì¨ë„ ìƒê´€ì´ ì—†ëŠ” ê²ƒì´ë‹¤ ì¤‘ìš”í•œ ê²ƒì€ ê·¸ í•¨ìˆ˜ì˜ ë‚´ìš©ì„ ì•Œê³  ì‹¶ì€ ê²ƒì´ ì•„ë‹ˆë¼ íŒŒë“œë“¤ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ê³  ì‹¶ì€ ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.</div>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">{pod!=â€â€}</span>:íŒŒë“œì˜ ì´ë¦„ì´ ë¹ˆ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²ƒì„ ë‹¤ ì¡°íšŒí•œë‹¤. ì¦‰ ëª¨ë“  íŒŒë“œë¥¼ ì¡°íšŒí•œë‹¤ëŠ” ê²ƒì´ë‹¤.<br /><br /></li>
  <li><span style="color:#3D9970; font-weight:bold">count by (pod)()</span>: íŒŒë“œëŠ” ì—¬ëŸ¬ ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ (pod), ì¦‰ íŒŒë“œë¡œ group by í•˜ê³  ê·¸ê²ƒì„ ì¹´ìš´íŒ…í•˜ëŠ” ê²ƒì´ë‹¤. ì•„ë˜ ì‚¬ì§„ì„ ì°¸ê³ í•œë‹¤.<br /><br /></li>
</ul>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-11-54-24.png" alt="" /></p>

<p><br /></p>
<ul>
  <li><span style="color:#3D9970; font-weight:bold">count()</span>: ìœ„ì˜ ì‚¬ì§„ì— ë‚˜ì˜¤ëŠ” ëª¨ë“  íŒŒë“œë“¤ì˜ ìˆ˜ë¥¼ êµ¬í•œë‹¤. <br /><br /></li>
</ul>

<hr />

<p>ë‹¤ìŒ ì§€í‘œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<p>PVCì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ëŠ” ì§€í‘œë‹¤.</p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-18-11-57-36.png" alt="" /></p>

<p><br /></p>

<pre><code class="language-PromQL">count(kube_persistentvolumeclaim_info)
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">kube_persistentvolumeclaim_info</span>: PVì™€ PVCì˜ ë§¤í•‘ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ”ë° ì—¬ê¸°ì„œëŠ” ê°œìˆ˜ë¥¼ êµ¬í•˜ëŠ” ê²ƒì„ìœ¼ë¡œ countë¡œ ê·¸ ê°œìˆ˜ë¥¼ êµ¬í•œë‹¤. <br /><br /></li>
</ul>

<hr />

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-09-44-40.png" alt="" /></p>

<p><br /></p>

<p>ì´ ëŒ€ì‹œë³´ë“œì— êµ¬ì„±ì€ í…Œì´ë¸”ë¡œ ë˜ì–´ ìˆë‹¤. ì»¬ëŸ¼ êµ¬ì„±ì€ <span style="color:orange; font-weight:bold">Transformì—ì„œ ë³¼ ìˆ˜ ìˆë‹¤.</span> ì•„ë˜ ì‚¬ì§„ì„ ì°¸ê³ í•˜ì.</p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-00-24.png" alt="" /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-09-45-51.png" alt="" /></p>

<p><br /></p>

<p>ë­”ê°€ ë§ì€ ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° í•˜ë‚˜ í•˜ë‚˜ ë´ ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-09-46-30.png" alt="" /></p>

<p><br /></p>

<pre><code class="language-PromQL">kube_node_info
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">kube_node_info</span>: í´ëŸ¬ìŠ¤í„° ë…¸ë“œì— ëŒ€í•œ ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤. <br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

ì´ ëŒ€ì‹œë³´ë“œì—ì„œ Pod CIDR, OS verison, Kernel version, K8s version, Docker versionì„ ë°˜í™˜í•œë‹¤. ì•„ë˜ ì‚¬ì§„ì˜ Filterê°€ ì²´í¬ë˜ì–´ ìˆëŠ” ê²ƒê³¼ ì—°ê´€ì´ ìˆë‹¤.</div>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-06-35.png" alt="" /></p>

<p><br /></p>

<p>ì§€ê¸ˆ Queryê°€ A, B, D, E, F ,G, H ì´ë ‡ê²Œ ìˆëŠ”ë° B, D, EëŠ” ì´ ëŒ€ì‹œë³´ë“œì—ì„œ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë‚´ìš©ì´ë‹¤. í”„ë¡œë©”í…Œìš°ìŠ¤ë¡œ ê°’ì„ í™•ì¸í•´ë³´ë ¤ê³  ëŒë ¤ë³´ë‹ˆ ê°’ì„ ì°¾ì„ ìˆ˜ê°€ ì—†ì—ˆë‹¤. ì™œ ì¶”ê°€í•œì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤. ê·¸ë˜ì„œ ë‚˜ëŠ” ì´ B, D, E ì¿¼ë¦¬ëŠ” í•´ì„í•˜ì§€ ì•Šìœ¼ë ¤ í•œë‹¤. ë°”ë¡œ Fë¥¼ ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-17-10.png" alt="" /></p>

<p><br /></p>

<pre><code class="language-PromQL">kube_node_role
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">kube_node_role</span>: í´ëŸ¬ìŠ¤í„° ë…¸ë“œì— ì—­í•  ì •ë³´ë¥¼ ë°˜í™˜í•œë‹¤. <br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

í…Œì´ë¸” ì»¬ëŸ¼ì—ì„œ role ì¤‘ì— masterì¸ ë…¸ë“œì˜ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.</div>

<p><br /></p>

<p>Query Gë¥¼ ë³´ì.</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-23-25.png" alt="" /></p>

<p><br /></p>

<pre><code class="language-PromQL">label_replace(up{job="kubernetes-nodes"}, "node", "$1", "instance", "(.+)")
</code></pre>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)</span>:  vì•ˆì— ê° ì‹œê³„ì—´ì— ëŒ€í•´ labe_replaceëŠ” ë ˆì´ë¸” src_labelì˜ ê°’ì— ëŒ€í•´ ì •ê·œì‹ regexì™€ ì¼ì¹˜ì‹œí‚¨ë‹¤. ë§Œì•½ ì¼ì¹˜í•œë‹¤ë©´ ì‹œê³„ì—´ì—ì„œ ë¦¬í„´ëœ ë ˆì´ë¸” dst_labelì˜ ê°’ì€ ì…ë ¥ì˜ ì›ë˜ ë ˆì´ë¸”ë“¤ê³¼ í•¨ê»˜ í™•ì¥ì´ ëœë‹¤. ì •ê·œì‹ì˜ ìº¡ì²˜ ê·¸ë£¹ì€ $1, $2 ë“±ìœ¼ë¡œ ì°¸ì¡°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ê·œì‹ì´ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì‹œê³„ì—´ì´ ë³€ê²½ë˜ì§€ ì•Šê³  ë°˜í™˜ë©ë‹ˆë‹¤.<br /><br /></li>
</ul>
<link href="http://fonts.googleapis.com/earlyaccess/hanna.css" rel="stylesheet" />

<div style="background: #eee;
  box-shadow: 0 8px 8px -4px lightblue; font-family: 'Hanna', sans-serif;; padding: 40px;">

ê³µì‹ ë¬¸ì„œë¥¼ ë°œë²ˆì—­í•œê±°ë¼ ì†”ì§íˆ ë¬´ìŠ¨ ë§ì¸ì§€ ì˜ ëª¨ë¥´ê² ë‹¤. ì‰½ê²Œ ìƒê°í•´ë³´ë©´ up{job="kubernetes-nodes}ë¥¼ í”„ë¡œë©”í…Œìš°ìŠ¤ì—ì„œ ëŒë¦¬ë©´ ì—¬ëŸ¬ ë ˆì´ë¸”ê³¼ ê°’ì´ ë‚˜ì˜¨ë‹¤. (ì•„ë˜ ì‚¬ì§„ ì°¸ê³ ) ê±°ê¸°ì„œ instance ë ˆì´ë¸”ê³¼ í•´ë‹¹í•˜ëŠ” ê°’ì´ ìˆëŠ”ë° ê·¸ instanceì˜ ê°’ì—ì„œ ì •ê·œì‹ê³¼ ì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ ì¶”ì¶œí•˜ê³  ê·¸ ì¶”ì¶œí•œ ê°’ì„ nodeë¼ëŠ” ìƒˆë¡œìš´ ë ˆì´ë¸”ì˜ ê°’ìœ¼ë¡œ ë„£ì–´ì£¼ëŠ” ê²ƒì´ë‹¤. ì¦‰ ì²˜ìŒ up{job="kubernetes-nodes}ì„ í–ˆì„ ë•Œ ë‚˜ì™”ë˜ ë ˆì´ë¸”ë“¤ê³¼ ê°’ë“¤ì— ìƒˆë¡œìš´ ë ˆì´ë¸” nodeë¥¼ ì¶”ê°€í•˜ê³  ê°’ì€ instance ë ˆì´ë¸”ì—ì„œ ì •ê·œì‹ê³¼ ë§¤ì¹­ë˜ëŠ” ê°’ì„ ì¶”ì¶œí•´ì„œ ë„£ì–´ì£¼ê² ë‹¤ëŠ” ê²ƒì´ë‹¤. $1ê³¼ $2ëŠ” ì •ê·œì‹ìœ¼ë¡œ ìº¡ì³ëœ ê·¸ë£¹ì„ ëª…ì‹œí•œë‹¤ëŠ” ê²ƒì´ë‹¤. </div>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-57-38.png" alt="" /></p>

<p><br /></p>

<p>label_replace()ë¥¼ ì¶”ê°€í•˜ê³  ë‚˜ë©´ ìœ„ ì‚¬ì§„ì—ì„œ <span style="color:orange; font-weight:bold">node</span> ë ˆì´ë¸”ê³¼ ê°’ì´ ì¶”ê°€ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.(ì•„ë˜ ì‚¬ì§„ ì°¸ê³ )</p>

<p><br /></p>

<p><img src="/images/Kubernetes/Kubernetes-Grafana-all-in-one/2021-08-19-10-58-20.png" alt="" /></p>

<p><br /></p>

<ul>
  <li><span style="color:#3D9970; font-weight:bold">up</span>: upì€ ìˆ˜ì§‘ ëŒ€ìƒì´ ì‘ë™í•˜ê³  ìˆëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤. ê²°ê³¼ë¡œ ë‚˜ì˜¨ ë©”íŠ¸ë¦­ ë°ì´í„°ë¥¼ ë³´ë©´ upì´ë¼ëŠ” ë©”íŠ¸ë¦­ ì´ë¦„ì„ ê°€ì§€ëŠ” ëŒ€ìƒì„ ê²€ìƒ‰í•˜ê³  ê·¸ì¤‘ì— job=â€kubernetes-nodesâ€ë¼ëŠ” ë ˆì´ë¸” ì´ë¦„ì„ ê²€ìƒ‰ ì¡°ê±´ì— ì¶”ê°€í•œë‹¤. ì´ë¥¼ ì¼ë°˜ì ìœ¼ë¡œ í•„í„°ë§ì´ë¼ê³  í•˜ê³  ê²€ìƒ‰ ì¡°ê±°ë„¤ ë§ëŠ” ë©”íŠ¸ë¦­ ë°ì´í„°ê°€ ì¡´ì¬í•˜ê³  ì¶”ì¶œì— ì„±ê³µí•˜ë©´ 1ì´ë¼ëŠ” ê°’ìœ¼ë¡œ í‘œí˜„í•œë‹¤. ì¦‰ ì—¬ê¸°ì„œ 1ì˜ ê°’ì„ ê°€ì§€ë‹ˆê¹Œ Node Status ê°’ì´ Goodë¥¼ í‘œì‹œí•œë‹¤.<br /><br /></li>
</ul>
:ET