I"I«<p><em>í•´ë‹¹ ë‚´ìš©ì€ ì±… â€˜ì½”ë“œë¡œ ë°°ìš°ëŠ” ìŠ¤í”„ë§ ë¶€íŠ¸ ì›¹ í”„ë¡œì íŠ¸â€™ì— ë‚˜ì˜¤ëŠ” ë‚´ìš©ì´ë©° ì´ëŠ” ê°œì¸ì ìœ¼ë¡œ ê³µë¶€í•˜ê¸° ìœ„í•´ ê¸°ë¡í•¨ì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</em></p>

<p><br /><br /></p>

<h1 id="springbootì™€-spring-security-ì—°ë™"><center>SpringBootì™€ Spring Security ì—°ë™</center></h1>

<p><br /></p>

<p>ì´ë²ˆ ì±•í„°ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ë‚´ìš©ì„ í•™ìŠµí•œë‹¤.</p>

<ul>
  <li>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œ ì œê³µí•˜ëŠ” ë¡œê·¸ì¸ ì²˜ë¦¬ ë°©ì‹ì˜ ì´í•´</li>
  <li>JPAì™€ ì—°ë™í•˜ëŠ” ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ ì²˜ë¦¬</li>
  <li>Thymeleafì—ì„œ ë¡œê·¸ì¸ ì •ë³´ í™œìš©í•˜ê¸°</li>
</ul>

<p><br /></p>

<p><strong>í”„ë¡œì íŠ¸ ìƒì„±</strong></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-21-18-00-36.png" alt="" /></p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-21-18-01-05.png" alt="" /></p>

<p><br /></p>

<p><strong>ì˜ì¡´ì„± ì¶”ê°€</strong></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-21-18-01-42.png" alt="" /></p>

<p><br /></p>

<style>

</style>

<p><strong>build.gradle ì„¤ì •</strong></p>

<div class="language-gradle highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">'org.springframework.boot'</span> <span class="n">version</span> <span class="s1">'2.5.2'</span>
    <span class="n">id</span> <span class="s1">'io.spring.dependency-management'</span> <span class="n">version</span> <span class="s1">'1.0.11.RELEASE'</span>
    <span class="n">id</span> <span class="s1">'java'</span>
    <span class="n">id</span> <span class="s1">'war'</span>
<span class="o">}</span>

<span class="n">group</span> <span class="o">=</span> <span class="s1">'org.young'</span>
<span class="n">version</span> <span class="o">=</span> <span class="s1">'0.0.1-SNAPSHOT'</span>
<span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="s1">'11'</span>

<span class="n">configurations</span> <span class="o">{</span>
    <span class="n">compileOnly</span> <span class="o">{</span>
        <span class="n">extendsFrom</span> <span class="n">annotationProcessor</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">repositories</span> <span class="o">{</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
<span class="o">}</span>

<span class="k">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-security'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-thymeleaf'</span>
    <span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-web'</span>
    <span class="n">implementation</span> <span class="s1">'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'</span>

    <span class="c1">//ì¶”ê°€í•œ ë¶€ë¶„</span>
    <span class="c1">//mysql ë“œë¼ì´ë²„</span>
    <span class="n">implementation</span> <span class="nl">group:</span> <span class="s1">'mysql'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'mysql-connector-java'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'8.0.25'</span>
    <span class="c1">//Thymeleaf í™•ì¥ í”ŒëŸ¬ê·¸ì¸ì€ í™”ë©´ì„ ì œì‘í•  ë•Œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ê°ì²´ë“¤ì„ ì²˜ë¦¬í•˜ëŠ” ìš©ë„ì´ë‹¤.</span>
    <span class="n">implementation</span> <span class="nl">group:</span> <span class="s1">'org.thymeleaf.extras'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'thymeleaf-extras-springsecurity5'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'3.0.4.RELEASE'</span>
    <span class="n">implementation</span> <span class="nl">group:</span> <span class="s1">'org.thymeleaf.extras'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'thymeleaf-extras-java8time'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'3.0.4.RELEASE'</span>
    <span class="c1">//</span>

    <span class="n">compileOnly</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">developmentOnly</span> <span class="s1">'org.springframework.boot:spring-boot-devtools'</span>
    <span class="n">annotationProcessor</span> <span class="s1">'org.projectlombok:lombok'</span>
    <span class="n">providedRuntime</span> <span class="s1">'org.springframework.boot:spring-boot-starter-tomcat'</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-test'</span>
    <span class="n">testImplementation</span> <span class="s1">'org.springframework.security:spring-security-test'</span>
<span class="o">}</span>

<span class="n">test</span> <span class="o">{</span>
    <span class="n">useJUnitPlatform</span><span class="o">()</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>application.properties</strong></p>

<pre><code class="language-application.properties">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/springsecurity?serverTimezone=UTC&amp;characterEncoding=UTF-8
spring.datasource.username=root
spring.datasource.password=root

#ì„œë²„ ì‹œì‘ ì‹œì ì— DDL ë¬¸ì„ ìƒì„±í•˜ì—¬ DBì— ì ìš©í•œë‹¤
spring.jpa.hibernate.ddl-auto=update
#Trueë¡œ í•˜ë©´ sqlë¬¸ì„ ë³´ê¸° ì¢‹ê²Œ ì„¤ì •í•œë‹¤
spring.jpa.properties.hibernate.format_sql=true
#ì ìš©ëœ sqlë¬¸ì„ ë³´ì—¬ì¤€ë‹¤.
spring.jpa.show-sql=true
#Thymeleaf í…œí”Œë¦¿ ìºì‹± ë¹„í™œì„±í™”
#thymeleafë¥¼ ì‚¬ìš©í•˜ë‹¤ ìˆ˜ì • ì‚¬í•­ì´ ìƒê¸¸ ëŒ€ ìˆ˜ì •ì„ í•˜ë©´
#ì¬ì‹œì‘ì„ í•´ì¤˜ì•¼ í•œë‹¤. cacheê°€ ê³„ì† ìŒ“ì´ê¸° ë•Œë¬¸ì´ë‹¤.
#ì´ë¥¼ ë°©ì§€í•˜ì—¬ ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ë§Œìœ¼ë¡œë„ ìˆ˜ì • ì‚¬í•­ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì´ê²ƒì„ ì¶”ê°€í•œë‹¤.
spring.thymeleaf.cache=false

spring.servlet.multipart.enabled=true
spring.servlet.multipart.location=C:\\Users\\nick1\\kpu\\spring_security\\upload
spring.servlet.multipart.max-request-size=30MB
spring.servlet.multipart.max-file-size=10MB

#ì—…ë°ì´íŠ¸ ì‹¤ì‹œê°„ ë°˜ì˜
spring.devtools.livereload.enabled=true

#ì‹œíë¦¬í‹°ì™€ ê´€ë ¨ëœ ë¶€ë¶„ì€ ì¢€ ë” ë¡œê·¸ ë ˆë²¨ì„ ë‚®ê²Œ ì„¤ì •í•´ì„œ ìì„¸í•œ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
logging.level.org.springframework.security.web=debug
logging.level.org.young.security=debug
</code></pre>

<p><br /></p>

<p>ì´ ìƒíƒœì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ë‚˜ ì‹¤í–‰í•´ ë³¸ë‹¤. ì‹¤í–‰í•˜ë©´ ì•„ë˜ ì‚¬ì§„ê³¼ ê°™ì´ <strong>password</strong>ê°€ ë‚˜ì˜¨ë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-16-06-24.png" alt="" /></p>

<p><br /></p>

<p>í”„ë¡œì íŠ¸ ì´ˆê¸°ì— ì•„ë¬´ ê³„ì •ë„ ì—†ì„ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì„ì‹œ íŒ¨ìŠ¤ì›Œë“œ ì—­í• ì„ í•œë‹¤. í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤ë©´ â€˜http://localhost:8080/loginâ€™ì˜ ê²½ë¡œë¡œ ì ‘ê·¼í•´ì„œ í™”ë©´ì—ì„œ <strong>â€˜userâ€™</strong>ë¼ëŠ” ê³„ì •ìœ¼ë¡œ ì„¤ì •í•˜ê³  ìœ„ì˜ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ì„œ ë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸ í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-16-07-51.png" alt="" /></p>

<p><br /></p>

<p>ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ì„±ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¨ë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-16-08-12.png" alt="" /></p>

<p><br /></p>

<p>ì‹œíë¦¬í‹° ì„¤ì • í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-16-20-04.png" alt="" /></p>

<p><br /></p>

<p><strong>SecurityConfig í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>

<span class="c1">//ì‹œíë¦¬í‹° ê´€ë ¨ ê¸°ëŠ¥ì„ ì‰½ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ WebSecurity ConfigurerAdapterë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì†ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.</span>
<span class="c1">//WebSecurityConfigurer Adapter í´ë˜ìŠ¤ëŠ” ì£¼ë¡œ overrideë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ì„¤ì •ì„ ì¡°ì •í•˜ê²Œ ëœë‹¤.</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p><strong>SampleController í´ë˜ìŠ¤</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.controller</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@Log4j2</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/sample/"</span><span class="o">)</span>
<span class="c1">//ì‹œíë¦¬í‹°ì™€ ê´€ë ¨ëœ ì„¤ì •ì´ ì •ìƒì ìœ¼ë¡œ ëŒì•„ê°€ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ ê°„ë‹¨í•œ ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬ì„±</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="o">{</span>
    <span class="c1">//ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” /sample/all</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/all"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exAll</span><span class="o">(){</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"exAll........."</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” '/sample/member'</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/member"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exMember</span><span class="o">(){</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"exMember........."</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">//ê´€ë¦¬ì(admin) ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” '/sample/admin'</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/admin"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exAdmin</span><span class="o">(){</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"exAdmin........."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì¸í•œ í˜ì´ì§€ê°€ í‘œì‹œë  ìˆ˜ ìˆë„ë¡ ëŒ€ì‘ë˜ëŠ” html íŒŒì¼ì„ êµ¬ì„±í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-16-21-36.png" alt="" /></p>

<p><br /></p>

<p><strong>all.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>For All<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>admin.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>For Admin<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>member.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>Title<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>For Member<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><br /></p>

<p>PasswordEncodingë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ SecurityConfig í´ë˜ìŠ¤ì— ì¶”ê°€í•œë‹¤.</p>

<p><br /></p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>

<span class="c1">//ì‹œíë¦¬í‹° ê´€ë ¨ ê¸°ëŠ¥ì„ ì‰½ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ WebSecurity ConfigurerAdapterë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì†ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.</span>
<span class="c1">//WebSecurityConfigurer Adapter í´ë˜ìŠ¤ëŠ” ì£¼ë¡œ overrideë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ì„¤ì •ì„ ì¡°ì •í•˜ê²Œ ëœë‹¤.</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="c1">//PasswordEncoderëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•˜ëŠ” ê²ƒì¸ë° ì£¼ëª©ì ì€ ì—­ì‹œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•˜ëŠ” ê²ƒì´ë‹¤</span>
    <span class="c1">//PasswordEncoderëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ì„¤ê³„ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì‹¤ì œ ì„¤ì •ì—ì„œëŠ” ì´ë¥¼ êµ¬í˜„í•˜ê±°ë‚˜ êµ¬í˜„ëœ í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì•¼ë§Œ í•œë‹¤.</span>
    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ì˜ PasswordEncoderë¥¼ ì œê³µí•˜ê³  ìˆëŠ”ë° ê·¸ì¤‘ì—ì„œë„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê²ƒì€</span>
    <span class="c1">//BCryptPasswordEncoderë¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤. ì´ëŠ” 'bcrypt'ë¼ëŠ” í•´ì‹œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•˜ëŠ” ëª©ì ìœ¼ë¡œ ì„¤ê³„ëë‹¤.</span>
    <span class="c1">//SecurityConfigì—ëŠ” @Beanì„ ì´ìš©í•´ì„œ BCryptPasswordEncoderë¥¼ ì§€ì •í•œë‹¤.</span>
    <span class="nd">@Bean</span>
    <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>PasswordTestsë¼ëŠ” í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ ë³¸ë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-08-02.png" alt="" /></p>

<p><br /></p>

<p><strong>PasswordTests.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.security</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PasswordTests</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span>

    <span class="c1">//BCryptPasswordEncoderë¡œ ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œëŠ” ë‹¤ì‹œ ì›ë˜ëŒ€ë¡œ ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤</span>
    <span class="c1">//ë§¤ë²ˆ ì•”í˜¸í™”ëœ ê°’ë„ ë‹¤ë¥´ê²Œ ëœë‹¤</span>
    <span class="c1">//ëŒ€ì‹ ì— íŠ¹ì •í•œ ë¬¸ìì—´ì´ ì•”í˜¸í™”ëœ ê²°ê³¼ì¸ì§€ë§Œì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.(.matches()í•¨ìˆ˜ë¥¼ í†µí•´ì„œ)</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEncoder</span><span class="o">(){</span>
        <span class="nc">String</span> <span class="n">password</span><span class="o">=</span><span class="s">"1111"</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">enPw</span><span class="o">=</span><span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"enPw:"</span><span class="o">+</span><span class="n">enPw</span><span class="o">);</span>

        <span class="kt">boolean</span> <span class="n">matchResult</span><span class="o">=</span><span class="n">passwordEncoder</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">password</span><span class="o">,</span> <span class="n">enPw</span><span class="o">);</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"matchResult: "</span><span class="o">+</span><span class="n">matchResult</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ì¸ì½”ë”©ëœ passwordê°€ ë‚˜íƒ€ë‚œë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-24-06.png" alt="" /></p>

<p><br /></p>

<p>enPwì— ë‚˜ì˜¤ëŠ” ë‚´ìš©ì„ ë³µì‚¬í•´ë‘ê³  ë‹¤ì‹œ SecurityConfig.javaë¡œ ëŒì•„ì™€ ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤.</p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>

<span class="c1">//ì‹œíë¦¬í‹° ê´€ë ¨ ê¸°ëŠ¥ì„ ì‰½ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ WebSecurity ConfigurerAdapterë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì†ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.</span>
<span class="c1">//WebSecurityConfigurer Adapter í´ë˜ìŠ¤ëŠ” ì£¼ë¡œ overrideë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ì„¤ì •ì„ ì¡°ì •í•˜ê²Œ ëœë‹¤.</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="c1">//PasswordEncoderëŠ” íŒ¨ìŠ¤ì›Œë“œë¥¼ ì¸ì½”ë”©í•˜ëŠ” ê²ƒì¸ë° ì£¼ëª©ì ì€ ì—­ì‹œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•˜ëŠ” ê²ƒì´ë‹¤</span>
    <span class="c1">//PasswordEncoderëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ì„¤ê³„ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì‹¤ì œ ì„¤ì •ì—ì„œëŠ” ì´ë¥¼ êµ¬í˜„í•˜ê±°ë‚˜ êµ¬í˜„ëœ í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ì•¼ë§Œ í•œë‹¤.</span>
    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ì˜ PasswordEncoderë¥¼ ì œê³µí•˜ê³  ìˆëŠ”ë° ê·¸ì¤‘ì—ì„œë„ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ê²ƒì€</span>
    <span class="c1">//BCryptPasswordEncoderë¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤. ì´ëŠ” 'bcrypt'ë¼ëŠ” í•´ì‹œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•˜ëŠ” ëª©ì ìœ¼ë¡œ ì„¤ê³„ëë‹¤.</span>
    <span class="c1">//SecurityConfigì—ëŠ” @Beanì„ ì´ìš©í•´ì„œ BCryptPasswordEncoderë¥¼ ì§€ì •í•œë‹¤.</span>
    <span class="nd">@Bean</span>
    <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">//SecurityConfigì—ëŠ” AuthenticationManagerì˜ ì„¤ì •ì„ ì‰½ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ”</span>
    <span class="c1">//configure() ë©”ì„œë“œë¥¼ overrideí•´ì„œ ì²˜ë¦¬í•œë‹¤. íŒŒë¼ë¯¸í„°ì˜ íƒ€ì…ì¸ AuthenticationManagerBuilderëŠ”</span>
    <span class="c1">//ë§ ê·¸ëŒ€ë¡œ ì½”ë“œë¥¼ í†µí•´ì„œ ì§ì ‘ ì¸ì¦ ë§¤ë‹ˆì €ë¥¼ ì„¤ì •í•  ë•Œ ì‚¬ìš©í•œë‹¤.</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">//ì‚¬ìš©ì ê³„ì •ì€ user1, ì¼ë‹¨ ì¸ë©”ëª¨ë¦¬ ìŠ¤í”¼ë§ ì‹œíë¦¬í‹°ë¥¼ ì‹¤í—˜í•œë‹¤.</span>
        <span class="c1">//inMemoryAuthentication()ëŠ” ì¸ ë©”ëª¨ë¦¬ authenticationë¥¼ AuthenticationManagerBuilderì— ì¶”ê°€í•˜ê³ </span>
        <span class="c1">//ì›í•˜ëŠ”ë°ë¡œ ì¸ ë©”ëª¨ë¦¬ authenticationë¥¼ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•œ InMemoryUserDetailsManagerConfigurer íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.</span>
        <span class="c1">//withUser()ëŠ” ìƒì„±ë˜ëŠ” UserDetailsManagerì— userë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì„ í—ˆìš©í•œë‹¤</span>
        <span class="c1">//ì´ í•¨ìˆ˜ëŠ” ë‹¤ìˆ˜ì˜ usersë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œì´ ê°€ëŠ¥í•˜ë‹¤</span>
        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">().</span><span class="na">withUser</span><span class="o">(</span><span class="s">"user1"</span><span class="o">)</span>
        <span class="c1">//1111 íŒ¨ìŠ¤ì›Œë“œ ì¸ì½”ë”© ê²°ê³¼</span>
        <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"$2a$10$3mm3ssAaaIYCfmJQu2w5KedCy.1yO7O3J9/Me72i5drQkHm54F2CW"</span><span class="o">)</span>
        <span class="c1">//ì‚¬ìš©ìê°€ ê°€ì§€ëŠ” ê¶Œí•œì€ USERë¼ëŠ” ê¶Œí•œìœ¼ë¡œ ì§€ì •í•œë‹¤.</span>
        <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ìœ„ì—ì„œ ì„¤ì •í•œ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ í†µí•´ì„œ localhost:8080/sample/allì— ì ‘ì†í•´ ë³¸ë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-27-48.png" alt="" /></p>

<p><br /></p>

<p>ê·¸ë¦¬ê³  ì¸ê°€(Authorization)ê°€ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ ì„¤ì •ì„ í•œë‹¤</p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>
<span class="o">(...)</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="o">(...)</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">(...)</span>
    <span class="o">}</span>

    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì •í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ì œí•œì„ í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.</span>
    <span class="c1">//1) ì„¤ì •ì„ í†µí•´ì„œ íŒ¨í„´ì„ ì§€ì •í•˜ê±°ë‚˜</span>
    <span class="c1">//2) ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</span>
    <span class="c1">//ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ë” ê°„ë‹¨í•˜ê¸´ í•˜ì§€ë§Œ ìš°ì„ ì€ SecurityConfig í´ë˜ìŠ¤ë¡œ ì„¤ì •í•´ ë³¸ë‹¤.</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="c1">//http.authorizeRequests()ë¡œ ì¸ì¦ì´ í•„ìš”í•œ ìì›ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê³  antMatchers()ëŠ”</span>
        <span class="c1">// '**/*'ì™€ ê°™ì€ ì•¤íŠ¸ ìŠ¤íƒ€ì¼ì˜ íŒ¨í„´ìœ¼ë¡œ ì›í•˜ëŠ” ìì›ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</span>
        <span class="c1">//ë§ˆì§€ë§‰ìœ¼ë¡œ permitAll()ì˜ ê²½ìš°ëŠ” ë§ ê·¸ëŒ€ë¡œ 'ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆë½'í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ</span>
        <span class="c1">//ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ìµëª…ì˜ ì‚¬ìš©ìë¡œ ê°„ì£¼ë˜ì–´ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.</span>
        <span class="c1">//í”„ë¡œì íŠ¸ë¥¼ ì¬ì‹œì‘í•´ì„œ /sample/allì— ì ‘ì†í•˜ë©´ ë³„ë„ì˜ ë¡œê·¸ì¸ ì—†ì´ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ ì§„ë‹¤.</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¤ì‹œ ì‹œì‘í•˜ê³  â€˜/sample/allâ€™ì— ì ‘ì†í•˜ë©´ ë³„ë‹¤ë¥¸ ë¡œê·¸ì¸ ì—†ì´ë„ í˜ì´ì§€ì— ì ‘ê·¼í•œë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-38-03.png" alt="" /></p>

<p><br /></p>

<p>ë°˜ë©´ ë‹¤ì‹œ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì„ ë³€ê²½í•˜ê³  â€˜/sample/memberâ€™ë¥¼ í˜¸ì¶œí•˜ë©´ Access Deniedëœë‹¤.</p>

<p><br /></p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>
<span class="o">(...)</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="o">(...)</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">(...)</span>
    <span class="o">}</span>

    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì •í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ì œí•œì„ í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.</span>
    <span class="c1">//1) ì„¤ì •ì„ í†µí•´ì„œ íŒ¨í„´ì„ ì§€ì •í•˜ê±°ë‚˜</span>
    <span class="c1">//2) ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</span>
    <span class="c1">//ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ë” ê°„ë‹¨í•˜ê¸´ í•˜ì§€ë§Œ ìš°ì„ ì€ SecurityConfig í´ë˜ìŠ¤ë¡œ ì„¤ì •í•´ ë³¸ë‹¤.</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="c1">//http.authorizeRequests()ë¡œ ì¸ì¦ì´ í•„ìš”í•œ ìì›ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê³  antMatchers()ëŠ”</span>
        <span class="c1">// '**/*'ì™€ ê°™ì€ ì•¤íŠ¸ ìŠ¤íƒ€ì¼ì˜ íŒ¨í„´ìœ¼ë¡œ ì›í•˜ëŠ” ìì›ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</span>
        <span class="c1">//ë§ˆì§€ë§‰ìœ¼ë¡œ permitAll()ì˜ ê²½ìš°ëŠ” ë§ ê·¸ëŒ€ë¡œ 'ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆë½'í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ</span>
        <span class="c1">//ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ìµëª…ì˜ ì‚¬ìš©ìë¡œ ê°„ì£¼ë˜ì–´ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.</span>
        <span class="c1">//í”„ë¡œì íŠ¸ë¥¼ ì¬ì‹œì‘í•´ì„œ /sample/allì— ì ‘ì†í•˜ë©´ ë³„ë„ì˜ ë¡œê·¸ì¸ ì—†ì´ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ ì§„ë‹¤.</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
         <span class="c1">//ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ê³  /sample/member'ë¥¼ í˜¸ì¶œí•˜ë©´ Access Denied ëœë‹¤.</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/member"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-42-04.png" alt="" /></p>

<p><br /></p>

<p>HttpSecurityì˜ formLogin()ì´ë¼ëŠ” ê¸°ëŠ¥ì€ ì´ì™€ ê°™ì´ ì¸ê°€/ì¸ì¦ ì ˆì°¨ì—ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ë„ë¡ ì§€ì •í•  ìˆ˜ ìˆê³  í™”ë©´ìœ¼ë¡œ ë¡œê·¸ì¸ ë°©ì‹ì„ ì§€ì›í•œë‹¤ëŠ” ì˜ë¯¸ë¡œ ì‚¬ìš©ëœë‹¤.</p>

<p><br /></p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>
<span class="o">(...)</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="o">(...)</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">(...)</span>
    <span class="o">}</span>

    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì •í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ì œí•œì„ í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.</span>
    <span class="c1">//1) ì„¤ì •ì„ í†µí•´ì„œ íŒ¨í„´ì„ ì§€ì •í•˜ê±°ë‚˜</span>
    <span class="c1">//2) ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</span>
    <span class="c1">//ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ë” ê°„ë‹¨í•˜ê¸´ í•˜ì§€ë§Œ ìš°ì„ ì€ SecurityConfig í´ë˜ìŠ¤ë¡œ ì„¤ì •í•´ ë³¸ë‹¤.</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="c1">//http.authorizeRequests()ë¡œ ì¸ì¦ì´ í•„ìš”í•œ ìì›ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê³  antMatchers()ëŠ”</span>
        <span class="c1">// '**/*'ì™€ ê°™ì€ ì•¤íŠ¸ ìŠ¤íƒ€ì¼ì˜ íŒ¨í„´ìœ¼ë¡œ ì›í•˜ëŠ” ìì›ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</span>
        <span class="c1">//ë§ˆì§€ë§‰ìœ¼ë¡œ permitAll()ì˜ ê²½ìš°ëŠ” ë§ ê·¸ëŒ€ë¡œ 'ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆë½'í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ</span>
        <span class="c1">//ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ìµëª…ì˜ ì‚¬ìš©ìë¡œ ê°„ì£¼ë˜ì–´ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.</span>
        <span class="c1">//í”„ë¡œì íŠ¸ë¥¼ ì¬ì‹œì‘í•´ì„œ /sample/allì— ì ‘ì†í•˜ë©´ ë³„ë„ì˜ ë¡œê·¸ì¸ ì—†ì´ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ ì§„ë‹¤.</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
         <span class="c1">//ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ê³  /sample/member'ë¥¼ í˜¸ì¶œí•˜ë©´ Access Denied ëœë‹¤.</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/member"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>

       <span class="c1">//ì¸ê°€/ì¸ì¦ì— ë¬¸ì œì‹œ ë¡œê·¸ì¸ í™”ë©´ë©´</span>
       <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-44-41.png" alt="" /></p>

<p><br /></p>

<p>ìœ„ ì‚¬ì§„ê³¼ ê°™ì´ formLogin()ì´ ì ìš©ë˜ë©´ ì¸ê°€/ì¸ì¦ì— ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ì— ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë³¼ ìˆ˜ ìˆê²Œ ëœë‹¤.</p>

<p><br /></p>

<p>formLogin()ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ logout() ë©”ì„œë“œë¥¼ ì´ìš©í•˜ë©´ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤. formLogout() ì—­ì‹œ ë¡œê·¸ì¸ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë³„ë„ì˜ ì„¤ì •ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ê°€ ì œê³µí•˜ëŠ” ì›¹ í˜ì´ì§€ë¥¼ ë³´ê²Œ ëœë‹¤. SecurityConfigì— logout()ì„ ì ìš©í•´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.</p>

<p><br /></p>

<p><strong>SecurityConfig.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.young.club.config</span><span class="o">;</span>
<span class="o">(...)</span>
<span class="c1">//ëª¨ë“  ì‹œíë¦¬í‹° ê´€ë ¨ ì„¤ì •ì´ ì¶”ê°€ë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì•ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ì˜ˆì œì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="o">(...)</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">(...)</span>
    <span class="o">}</span>

    <span class="c1">//ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•´ì„œ íŠ¹ì •í•œ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ ì œí•œì„ í•˜ëŠ” ë°©ì‹ì€ í¬ê²Œ ë‘ ê°€ì§€ì´ë‹¤.</span>
    <span class="c1">//1) ì„¤ì •ì„ í†µí•´ì„œ íŒ¨í„´ì„ ì§€ì •í•˜ê±°ë‚˜</span>
    <span class="c1">//2) ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.</span>
    <span class="c1">//ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ëŠ” ë°©ì‹ì´ ë” ê°„ë‹¨í•˜ê¸´ í•˜ì§€ë§Œ ìš°ì„ ì€ SecurityConfig í´ë˜ìŠ¤ë¡œ ì„¤ì •í•´ ë³¸ë‹¤.</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
       <span class="c1">//http.authorizeRequests()ë¡œ ì¸ì¦ì´ í•„ìš”í•œ ìì›ë“¤ì„ ì„¤ì •í•  ìˆ˜ ìˆê³  antMatchers()ëŠ”</span>
        <span class="c1">// '**/*'ì™€ ê°™ì€ ì•¤íŠ¸ ìŠ¤íƒ€ì¼ì˜ íŒ¨í„´ìœ¼ë¡œ ì›í•˜ëŠ” ìì›ì„ ì„ íƒí•  ìˆ˜ ìˆë‹¤.</span>
        <span class="c1">//ë§ˆì§€ë§‰ìœ¼ë¡œ permitAll()ì˜ ê²½ìš°ëŠ” ë§ ê·¸ëŒ€ë¡œ 'ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆë½'í•œë‹¤ëŠ” ì˜ë¯¸ì´ë¯€ë¡œ</span>
        <span class="c1">//ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ìµëª…ì˜ ì‚¬ìš©ìë¡œ ê°„ì£¼ë˜ì–´ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.</span>
        <span class="c1">//í”„ë¡œì íŠ¸ë¥¼ ì¬ì‹œì‘í•´ì„œ /sample/allì— ì ‘ì†í•˜ë©´ ë³„ë„ì˜ ë¡œê·¸ì¸ ì—†ì´ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ ì§„ë‹¤.</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
         <span class="c1">//ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•˜ê³  /sample/member'ë¥¼ í˜¸ì¶œí•˜ë©´ Access Denied ëœë‹¤.</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/member"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>

       <span class="c1">//ì¸ê°€/ì¸ì¦ì— ë¬¸ì œì‹œ ë¡œê·¸ì¸ í™”ë©´ë©´</span>
       <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
        <span class="c1">//csrf í† í°ì„ ë°œí–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.</span>
       <span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
       <span class="c1">//ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬</span>
       <span class="n">http</span><span class="o">.</span><span class="na">logout</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<p>í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ê³  /sample/memberë¡œ ì ‘ê·¼í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë¡œê·¸ì•„ì›ƒ ë˜ê³  ë‹¤ì‹œ ë¡œê·¸ì¸ì„ í•˜ë¼ëŠ” ìƒíƒœê°€ ëœë‹¤.</p>

<p><br /></p>

<p><img src="/images/SpringBoot/LearningSpringbootWithWebProject-10.1/2021-07-24-17-59-51.png" alt="" /></p>

<p><br /></p>

<p>logout()ì—ì„œ ì£¼ì˜í•´ì•¼ í•  ì ì€ CSRF í† í°ì„ ì‚¬ìš©í•  ë•ŒëŠ” ë°˜ë“œì‹œ POST ë°©ì‹ìœ¼ë¡œë§Œ ë¡œê·¸ì•„ì›ƒì„ ì²˜ë¦¬í•œë‹¤ëŠ” ì ì´ë‹¤. CSRF í† í°ì„ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” /logout ì´ë¼ëŠ” URLì„ í˜¸ì¶œí–ˆì„ ë•ŒëŠ” &lt;form&gt; íƒœê·¸ì™€ ë²„íŠ¼ìœ¼ë¡œ êµ¬ì„±ëœ í™”ë©´ì„ ë³´ê²Œ ë˜ì§€ë§Œ CSRF í† í°ì„ disable()ë¡œ ë¹„í™œì„±í™” ì‹œí‚¤ë©´ GET ë°©ì‹(â€˜/logoutâ€™)ìœ¼ë¡œë„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ëœë‹¤.(ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´)</p>
:ET