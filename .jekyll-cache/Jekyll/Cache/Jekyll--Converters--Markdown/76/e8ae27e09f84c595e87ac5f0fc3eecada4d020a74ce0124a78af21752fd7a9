I"€H<p><br /><br /></p>

<h1 id="ê²€ìƒ‰ì²˜ë¦¬"><center>ê²€ìƒ‰ì²˜ë¦¬</center></h1>

<p><br /></p>

<p>ì´ë²ˆ ê²Œì‹œë¬¼ì—ì„œëŠ” í™”ë©´ì—ì„œ ê²€ìƒ‰ ì²˜ë¦¬ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ë³¸ë‹¤. ê²€ìƒ‰ ì²˜ë¦¬ëŠ” í¬ê²Œ ì„œë²„ ì‚¬ì´ë“œ ì²˜ë¦¬ì™€ í™”ë©´ ìª½ì˜ ì²˜ë¦¬ë¡œ ë‚˜ë‰œë‹¤.</p>

<p>ì„œë²„ ì‚¬ì´ë“œ ì²˜ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<ul>
  <li>PageRequestDTOì— ê²€ìƒ‰ íƒ€ì…(type)ê³¼ í‚¤ì›Œë“œ(keyword)ë¥¼ ì¶”ê°€</li>
  <li>ì´í•˜ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ Querydslì„ ì´ìš©í•´ì„œ ê²€ìƒ‰ ì²˜ë¦¬</li>
</ul>

<p><br /></p>

<p>ê²€ìƒ‰ í•­ëª©ì€ í¬ê²Œ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•œë‹¤.</p>

<ul>
  <li>â€˜ì œëª©(t), ë‚´ìš©(c), ì‘ì„±ì(w)â€™ë¡œ ê²€ìƒ‰í•˜ëŠ” ê²½ìš°</li>
  <li>â€˜ì œëª© í˜¹ì€ ë‚´ìš©(tc)â€™ìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê²½ìš°</li>
  <li>â€˜ì œëª© í˜¹ì€ ë‚´ìš© í˜¹ì€ ì‘ì„±ì(tcw)â€™ë¡œ ê²€ìƒ‰í•˜ëŠ” ê²½ìš°</li>
</ul>

<p><br /></p>

<p>ê°€ì¥ ìš°ì„ ìœ¼ë¡œ PageRequestDTOì„ ê²€ìƒ‰ ì¡°ê±´(type)ê³¼ ê²€ìƒ‰ í‚¤ì›Œë“œ(keyword)ë¥¼ ì¶”ê°€í•œë‹¤.</p>

<p><strong>PageRequestDTO.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.zerock.guestbook.dto</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.PageRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Pageable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Sort</span><span class="o">;</span>

<span class="nd">@Builder</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageRequestDTO</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">page</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">keyword</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nf">PageRequestDTO</span><span class="o">(){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">page</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Pageable</span> <span class="nf">getPageable</span><span class="o">(</span><span class="nc">Sort</span> <span class="n">sort</span><span class="o">){</span>

        <span class="k">return</span> <span class="nc">PageRequest</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">page</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="n">size</span><span class="o">,</span> <span class="n">sort</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>PageRequestDTOì—ì„œ ë³€ê²½ëœ ê²ƒì€ typeê³¼ keywordê°€ ì¶”ê°€ëœ ê²ƒë¿ì´ë‹¤.</p>

<p>ë™ì ìœ¼ë¡œ ê²€ìƒ‰ ì¡°ê±´ì´ ì²˜ë¦¬ë˜ëŠ” ê²½ìš°ì˜ ì‹¤ì œ ì½”ë”©ì€ Querydslì„ í†µí•´ì„œ BooleanBuilderë¥¼ ì‘ì„±í•˜ê³  GuestbookRepositoryëŠ” Querydslë¡œ ì‘ì„±ëœ BooleanBuilderë¥¼ findAll()ì²˜ë¦¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤. BooleanBuilder ì‘ì„±ì€ ë³„ë„ì˜ í´ë˜ìŠ¤ ë“±ì„ ì‘ì„±í•´ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ê°„ë‹¨íˆ í•˜ë ¤ë©´ GuestbookServiceImpl ë‚´ì— ë©”ì„œë“œë¥¼ í•˜ë‚˜ ì‘ì„±í•´ì„œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.</p>

<p><strong>GuestbookServiceImpl.java ì¼ë¶€</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre><span class="o">(...)</span>
<span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">GuestbookDTO</span> <span class="nf">read</span><span class="o">(</span><span class="nc">Long</span> <span class="n">gno</span><span class="o">)</span> <span class="o">{</span>
         <span class="o">(...)</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Long</span> <span class="n">gno</span><span class="o">)</span> <span class="o">{</span>

         <span class="o">(...)</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modify</span><span class="o">(</span><span class="nc">GuestbookDTO</span> <span class="n">dto</span><span class="o">)</span> <span class="o">{</span>
        <span class="o">(...)</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">BooleanBuilder</span> <span class="nf">getSearch</span><span class="o">(</span><span class="nc">PageRequestDTO</span> <span class="n">requestDTO</span><span class="o">){</span>

        <span class="nc">String</span> <span class="n">type</span> <span class="o">=</span> <span class="n">requestDTO</span><span class="o">.</span><span class="na">getType</span><span class="o">();</span>

        <span class="nc">BooleanBuilder</span> <span class="n">booleanBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BooleanBuilder</span><span class="o">();</span>

        <span class="nc">QGuestbook</span> <span class="n">qGuestbook</span> <span class="o">=</span> <span class="nc">QGuestbook</span><span class="o">.</span><span class="na">guestbook</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">keyword</span> <span class="o">=</span> <span class="n">requestDTO</span><span class="o">.</span><span class="na">getKeyword</span><span class="o">();</span>

        <span class="nc">BooleanExpression</span> <span class="n">expression</span> <span class="o">=</span> <span class="n">qGuestbook</span><span class="o">.</span><span class="na">gno</span><span class="o">.</span><span class="na">gt</span><span class="o">(</span><span class="mi">0L</span><span class="o">);</span> <span class="c1">// gno &gt; 0 ì¡°ê±´ë§Œ ìƒì„±</span>

        <span class="n">booleanBuilder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">expression</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">type</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">type</span><span class="o">.</span><span class="na">trim</span><span class="o">().</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">){</span> <span class="c1">//ê²€ìƒ‰ ì¡°ê±´ì´ ì—†ëŠ” ê²½ìš°</span>
            <span class="k">return</span> <span class="n">booleanBuilder</span><span class="o">;</span>
        <span class="o">}</span>


        <span class="c1">//ê²€ìƒ‰ ì¡°ê±´ì„ ì‘ì„±í•˜ê¸°</span>
        <span class="nc">BooleanBuilder</span> <span class="n">conditionBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BooleanBuilder</span><span class="o">();</span>

        <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"t"</span><span class="o">)){</span>
            <span class="n">conditionBuilder</span><span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">qGuestbook</span><span class="o">.</span><span class="na">title</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">keyword</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"c"</span><span class="o">)){</span>
            <span class="n">conditionBuilder</span><span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">qGuestbook</span><span class="o">.</span><span class="na">content</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">keyword</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">type</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"w"</span><span class="o">)){</span>
            <span class="n">conditionBuilder</span><span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">qGuestbook</span><span class="o">.</span><span class="na">writer</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">keyword</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">//ëª¨ë“  ì¡°ê±´ í†µí•©</span>
        <span class="n">booleanBuilder</span><span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">conditionBuilder</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">booleanBuilder</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>GuestbookServiceImplì— ì‘ì„±í•œ getSearch()ëŠ” PageRequestDTOë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì„œ ê²€ìƒ‰ ì¡°ê±´(type)ì´ ìˆëŠ” ê²½ìš°ì—ëŠ” conditionBuilder ë³€ìˆ˜ë¥¼ ìƒì„±í•´ì„œ ê° ê²€ìƒ‰ ì¡°ê±´ì„ â€˜orâ€™ë¡œ ì—°ê²°í•´ì„œ ì²˜ë¦¬í•œë‹¤. ë°˜ë©´ì— ê²€ìƒ‰ ì¡°ê±´ì´ ì—†ë‹¤ë©´ â€˜gno&gt;0â€™ìœ¼ë¡œë§Œ ìƒì„±ëœë‹¤. GuestbookServiceImplì—ì„œ ëª©ë¡ì„ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” getList()ëŠ” ê¸°ì¡´ì˜ ì½”ë“œë¥¼ ì¡°ê¸ˆ ìˆ˜ì •í•´ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•œë‹¤.</p>

<p><br /></p>

<p><strong>GuestbookServiceImpl.java ì¼ë¶€</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">PageResultDTO</span><span class="o">&lt;</span><span class="nc">GuestbookDTO</span><span class="o">,</span> <span class="nc">Guestbook</span><span class="o">&gt;</span> <span class="nf">getList</span><span class="o">(</span><span class="nc">PageRequestDTO</span> <span class="n">requestDTO</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="n">requestDTO</span><span class="o">.</span><span class="na">getPageable</span><span class="o">(</span><span class="nc">Sort</span><span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="s">"gno"</span><span class="o">).</span><span class="na">descending</span><span class="o">());</span>

        <span class="nc">BooleanBuilder</span> <span class="n">booleanBuilder</span><span class="o">=</span><span class="n">getSearch</span><span class="o">(</span><span class="n">requestDTO</span><span class="o">);</span>
        
        <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Guestbook</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">booleanBuilder</span><span class="o">,</span><span class="n">pageable</span><span class="o">);</span>

        <span class="nc">Function</span><span class="o">&lt;</span><span class="nc">Guestbook</span><span class="o">,</span> <span class="nc">GuestbookDTO</span><span class="o">&gt;</span> <span class="n">fn</span> <span class="o">=</span> <span class="o">(</span><span class="n">entity</span> <span class="o">-&gt;</span> <span class="n">entityToDto</span><span class="o">(</span><span class="n">entity</span><span class="o">));</span>


        <span class="k">return</span> <span class="k">new</span> <span class="nc">PageResultDTO</span><span class="o">&lt;&gt;(</span><span class="n">result</span><span class="o">,</span> <span class="n">fn</span> <span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ìœ„ì™€ ê°™ì´ ì„œë¹„ìŠ¤ ì˜ì—­ì—ì„œ ê²€ìƒ‰ ì¡°ê±´ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆë‹¤ë©´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ê²°ê³¼ë¥¼ í™•ì¸í•œë‹¤.</p>

<p><img src="/images/Learning_SpringBoot_with_Web_Project/Part4/Chapter7/2021-03-13-13-34-27.png" alt="" /></p>

<p><br /></p>

<p><strong>GuestbookServiceTests.java ì¼ë¶€</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSearch</span><span class="o">(){</span>
        <span class="nc">PageRequestDTO</span> <span class="n">pageRequestDTO</span><span class="o">=</span><span class="nc">PageRequestDTO</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">page</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
                <span class="o">.</span><span class="na">size</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"tc"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">keyword</span><span class="o">(</span><span class="s">"í•œê¸€"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="nc">PageResultDTO</span><span class="o">&lt;</span><span class="nc">GuestbookDTO</span><span class="o">,</span> <span class="nc">Guestbook</span><span class="o">&gt;</span> <span class="n">resultDTO</span><span class="o">=</span><span class="n">service</span><span class="o">.</span><span class="na">getList</span><span class="o">(</span><span class="n">pageRequestDTO</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"PREV: "</span><span class="o">+</span><span class="n">resultDTO</span><span class="o">.</span><span class="na">isPrev</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"NEXT: "</span><span class="o">+</span><span class="n">resultDTO</span><span class="o">.</span><span class="na">isNext</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"TOTAL: "</span><span class="o">+</span><span class="n">resultDTO</span><span class="o">.</span><span class="na">getTotalPage</span><span class="o">());</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"-----------------------------------"</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">GuestbookDTO</span> <span class="nl">guestbookDTO:</span><span class="n">resultDTO</span><span class="o">.</span><span class="na">getDtoList</span><span class="o">()){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">guestbookDTO</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"==================================="</span><span class="o">);</span>
        <span class="n">resultDTO</span><span class="o">.</span><span class="na">getPageList</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">i</span><span class="o">-&gt;</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>

    <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p><br /></p>

<p>ìœ„ì˜ ì½”ë“œëŠ” â€˜ì œëª©(t)ì´ë‚˜ ë‚´ìš©(c)â€™ì— â€˜í•œê¸€â€™ì´ë¼ëŠ” í‚¤ì›Œë“œê°€ ìˆëŠ” ê¸€ì„ ê²€ìƒ‰í•œë‹¤.</p>
:ET